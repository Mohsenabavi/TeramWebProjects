/*!
 * bootstrap-fileinput v5.1.2
 * http://plugins.krajee.com/file-input
 *
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2020, Kartik Visweswaran, Krajee.com
 *
 * Licensed under the BSD-3-Clause
 * https://github.com/kartik-v/bootstrap-fileinput/blob/master/LICENSE.md
 */
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery"],n):typeof module=="object"&&module.exports?module.exports=n(require("jquery")):n(window.jQuery)})(function(n){"use strict";var t,i,r;n.fn.fileinputLocales={};n.fn.fileinputThemes={};String.prototype.setTokens=function(n){var i=this.toString(),t,r;for(t in n)n.hasOwnProperty(t)&&(r=new RegExp("{"+t+"}","g"),i=i.replace(r,n[t]));return i};Array.prototype.flatMap||(Array.prototype.flatMap=function(n){return[].concat(this.map(n))});t={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",INIT_FLAG:"init-",OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}<\/span>\n<\/div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],logMessages:{ajaxError:"{status}: {error}. Error Details: {text}.",badDroppedFiles:"Error scanning dropped files!",badExifParser:"Error loading the piexif.js library. {details}",badInputType:'The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.',exifWarning:'To avoid this warning, either set "autoOrientImage" to "false" OR ensure you have loaded the "piexif.js" library correctly on your page before the "fileinput.js" script.',invalidChunkSize:'Invalid upload chunk size: "{chunkSize}". Resumable uploads are disabled.',invalidThumb:'Invalid thumb frame with id: "{id}".',noResumableSupport:"The browser does not support resumable or chunk uploads.",noUploadUrl:'The "uploadUrl" is not set. Ajax uploads and resumable uploads have been disabled.',retryStatus:"Retrying upload for chunk # {chunk} for {filename}... retry # {retry}.",chunkQueueError:"Could not push task to ajax pool for chunk index # {index}.",resumableMaxRetriesReached:"Maximum resumable ajax retries ({n}) reached.",resumableRetryError:"Could not retry the resumable request (try # {n})... aborting.",resumableAborting:"Aborting / cancelling the resumable request."},objUrl:window.URL||window.webkitURL,now:function(){return(new Date).getTime()},round:function(n){return n=parseFloat(n),isNaN(n)?0:Math.floor(Math.round(n))},getArray:function(n){for(var i=[],r=n&&n.length||0,t=0;t<r;t++)i.push(n[t]);return i},getFileRelativePath:function(n){return String(n.newPath||n.relativePath||n.webkitRelativePath||t.getFileName(n)||null)},getFileId:function(n,i){var r=t.getFileRelativePath(n);return typeof i=="function"?i(n):n?r?n.size+"_"+r.replace(/\s/img,"_"):null:null},getFrameSelector:function(n,t){return t=t||"",'[id="'+n+'"]'+t},getZoomSelector:function(n,i){return t.getFrameSelector("zoom-"+n,i)},getFrameElement:function(n,i,r){return n.find(t.getFrameSelector(i,r))},getZoomElement:function(n,i,r){return n.find(t.getZoomSelector(i,r))},getElapsed:function(i){var e=i,r="",u={},f={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};return t.getObjectKeys(f).forEach(function(n){u[n]=Math.floor(e/f[n]);e-=u[n]*f[n]}),n.each(u,function(n,t){t>0&&(r+=(r?" ":"")+t+n.substring(0,1))}),r},debounce:function(n,t){var i;return function(){var r=arguments,u=this;clearTimeout(i);i=setTimeout(function(){n.apply(u,r)},t)}},stopEvent:function(n){n.stopPropagation();n.preventDefault()},getFileName:function(n){return n?n.fileName||n.name||"":""},createObjectURL:function(n){return t.objUrl&&t.objUrl.createObjectURL&&n?t.objUrl.createObjectURL(n):""},revokeObjectURL:function(n){t.objUrl&&t.objUrl.revokeObjectURL&&n&&t.objUrl.revokeObjectURL(n)},compare:function(n,t,i){return n!==undefined&&(i?n===t:n.match(t))},isIE:function(n){var t,i;return navigator.appName!=="Microsoft Internet Explorer"?!1:n===10?new RegExp("msie\\s"+n,"i").test(navigator.userAgent):(t=document.createElement("div"),t.innerHTML="<!--[if IE "+n+"]> <i><\/i> <![endif]-->",i=t.getElementsByTagName("i").length,document.body.appendChild(t),t.parentNode.removeChild(t),i)},canOrientImage:function(t){var i=n(document.createElement("img")).css({width:"1px",height:"1px"}).insertAfter(t),r=i.css("image-orientation");return i.remove(),!!r},canAssignFilesToInput:function(){var n=document.createElement("input");try{return n.type="file",n.files=null,!0}catch(t){return!1}},getDragDropFolders:function(n){var t,i,r=n?n.length:0,u=0;if(r>0&&n[0].webkitGetAsEntry())for(t=0;t<r;t++)i=n[t].webkitGetAsEntry(),i&&i.isDirectory&&u++;return u},initModal:function(t){var i=n("body");i.length&&t.appendTo(i)},isFunction:function(n){return typeof n=="function"},isEmpty:function(i,r){return i===undefined||i===null||!t.isFunction(i)&&(i.length===0||r&&n.trim(i)==="")},isArray:function(n){return Array.isArray(n)||Object.prototype.toString.call(n)==="[object Array]"},ifSet:function(n,t,i){return i=i||"",t&&typeof t=="object"&&n in t?t[n]:i},cleanArray:function(n){return n instanceof Array||(n=[]),n.filter(function(n){return n!==undefined&&n!==null})},spliceArray:function(t,i,r){var u,o=0,e=[],f;if(!(t instanceof Array))return[];for(f=n.extend(!0,[],t),r&&f.reverse(),u=0;u<f.length;u++)u!==i&&(e[o]=f[u],o++);return r&&e.reverse(),e},getNum:function(n,t){return(t=t||0,typeof n=="number")?n:(typeof n=="string"&&(n=parseFloat(n)),isNaN(n)?t:n)},hasFileAPISupport:function(){return!!(window.File&&window.FileReader)},hasDragDropSupport:function(){var n=document.createElement("div");return!t.isIE(9)&&(n.draggable!==undefined||n.ondragstart!==undefined&&n.ondrop!==undefined)},hasFileUploadSupport:function(){return t.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(n){return!1}},hasArrayBufferViewSupport:function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(n){return!1}},hasResumableUploadSupport:function(){return t.hasFileUploadSupport()&&t.hasBlobSupport()&&t.hasArrayBufferViewSupport()&&(!!Blob.prototype.webkitSlice||!!Blob.prototype.mozSlice||!!Blob.prototype.slice||!1)},dataURI2Blob:function(n){var s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,h=t.hasBlobSupport(),r,u,f,i,e,o,c=(h||s)&&window.atob&&window.ArrayBuffer&&window.Uint8Array;if(!c)return null;for(r=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):decodeURIComponent(n.split(",")[1]),u=new ArrayBuffer(r.length),f=new Uint8Array(u),i=0;i<r.length;i+=1)f[i]=r.charCodeAt(i);return(e=n.split(",")[0].split(":")[1].split(";")[0],h)?new Blob([t.hasArrayBufferViewSupport()?f:u],{type:e}):(o=new s,o.append(u),o.getBlob(e))},arrayBuffer2String:function(n){if(window.TextDecoder)return new TextDecoder("utf-8").decode(n);for(var t=Array.prototype.slice.apply(new Uint8Array(n)),u="",i=0,r,f,o,e=t.length;i<e;){r=t[i++];switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(r);break;case 12:case 13:f=t[i++];u+=String.fromCharCode((r&31)<<6|f&63);break;case 14:f=t[i++];o=t[i++];u+=String.fromCharCode((r&15)<<12|(f&63)<<6|(o&63)<<0)}}return u},isHtml:function(n){var r=document.createElement("div"),t,i;for(r.innerHTML=n,t=r.childNodes,i=t.length;i--;)if(t[i].nodeType===1)return!0;return!1},isSvg:function(n){return n.match(/^\s*<\?xml/i)&&(n.match(/<!DOCTYPE svg/i)||n.match(/<svg/i))},getMimeType:function(n,t,i){switch(n){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"89504e47":return"image/png";case"47494638":return"image/gif";case"49492a00":return"image/tiff";case"52494646":return"image/webp";case"66747970":return"video/3gp";case"4f676753":return"video/ogg";case"1a45dfa3":return"video/mkv";case"000001ba":case"000001b3":return"video/mpeg";case"3026b275":return"video/wmv";case"25504446":return"application/pdf";case"25215053":return"application/ps";case"504b0304":case"504b0506":case"504b0508":return"application/zip";case"377abcaf":return"application/7z";case"75737461":return"application/tar";case"7801730d":return"application/dmg";default:switch(n.substring(0,6)){case"435753":return"application/x-shockwave-flash";case"494433":return"audio/mp3";case"425a68":return"application/bzip";default:switch(n.substring(0,4)){case"424d":return"image/bmp";case"fffb":return"audio/mp3";case"4d5a":return"application/exe";case"1f9d":case"1fa0":return"application/zip";case"1f8b":return"application/gzip";default:return t&&!t.match(/[^\u0000-\u007f]/)?"application/text-plain":i}}}},addCss:function(n,t){n.removeClass(t).addClass(t)},getElement:function(i,r,u){return t.isEmpty(i)||t.isEmpty(i[r])?u:n(i[r])},createElement:function(t,i){return i=i||"div",n(n.parseHTML("<"+i+">"+t+"<\/"+i+">"))},uniqId:function(){return((new Date).getTime()+Math.floor(Math.random()*Math.pow(10,15))).toString(36)},parseEventCallback:function(n){return Function("'use strict'; return (function() { "+n+" });")()},cspBuffer:{CSP_ATTRIB:"data-csp-01928735",domEventsList:["mousedown","mouseup","click","dblclick","mousemove","mouseover","mousewheel","mouseout","contextmenu","touchstart","touchmove","touchend","touchcancel","keydown","keypress","keyup","focus","blur","change","submit","scroll","resize","hashchange","load","unload","cut","copy","paste"],domElementEvents:{},domElementsStyles:{},stash:function(i){var r=this,u=n.parseHTML("<div>"+i+"<\/div>"),f=n(u),e;return f.find("[style]").each(function(i,u){var e=n(u),f=e.attr("style"),o=t.uniqId(),s={};f&&f.length&&(f.indexOf(";")===-1&&(f+=";"),f.slice(0,f.length-1).split(";").map(function(n){n=n.split(":");n[0]&&(s[n[0]]=n[1]?n[1]:"")}),r.domElementsStyles[o]=s,e.removeAttr("style").attr(r.CSP_ATTRIB,o))}),f.filter("*").removeAttr("style"),n.each(r.domEventsList,function(n,i){var u,s,o="on"+i,e=f.find("["+o+"]");e.length&&(s=t.parseEventCallback(e.attr(o)),e.attr(r.CSP_ATTRIB)?u=e.attr(r.CSP_ATTRIB):(u=t.uniqId(),r.domElementEvents[u]=[]),r.domElementEvents[u].push({name:i+".csp",handler:s}),e.removeAttr(o).attr(r.CSP_ATTRIB,u))}),e=Object.values?Object.values(u):Object.keys(u).map(function(n){return u[n]}),e.flatMap(function(n){return n.innerHTML}).join("")},apply:function(t){var i=this,r=n(t);r.find("["+i.CSP_ATTRIB+"]").each(function(t,r){var u=n(r),f=u.attr(i.CSP_ATTRIB),e=i.domElementsStyles[f],o=i.domElementEvents[f];e&&u.css(e);o&&n.each(o,function(n,t){if(t&&t.name)u.off(t.name).on(t.name,t.handler)});u.removeAttr(i.CSP_ATTRIB)});i.domElementsStyles={};i.domElementEvents={}}},setHtml:function(n,i){var r=t.cspBuffer;return n.html(r.stash(i)),r.apply(n),n},htmlEncode:function(n,t){return n===undefined?t||null:n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(t,i){var r=t;return i?(n.each(i,function(n,t){typeof t=="function"&&(t=t());r=r.split(n).join(t)}),r):r},cleanMemory:function(n){var i=n.is("img")?n.attr("src"):n.find("source").attr("src");t.revokeObjectURL(i)},findFileName:function(n){var t=n.lastIndexOf("/");return t===-1&&(t=n.lastIndexOf("\\")),n.split(n.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(n){var i=document,r=i.documentElement,u=t.checkFullScreen();r&&n&&!u?r.requestFullscreen?r.requestFullscreen():r.msRequestFullscreen?r.msRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):u&&(i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen&&i.webkitExitFullscreen())},moveArray:function(t,i,r,u){var f=n.extend(!0,[],t),e;if(u&&f.reverse(),r>=f.length)for(e=r-f.length;e--+1;)f.push(undefined);return f.splice(r,0,f.splice(i,1)[0]),u&&f.reverse(),f},closeButton:function(n){return n=n?"close "+n:"close",'<button type="button" class="'+n+'" aria-label="Close">\n  <span aria-hidden="true">&times;<\/span>\n<\/button>'},getRotation:function(n){switch(n){case 2:return"rotateY(180deg)";case 3:return"rotate(180deg)";case 4:return"rotate(180deg) rotateY(180deg)";case 5:return"rotate(270deg) rotateY(180deg)";case 6:return"rotate(90deg)";case 7:return"rotate(90deg) rotateY(180deg)";case 8:return"rotate(270deg)";default:return""}},setTransform:function(n,t){n&&(n.style.transform=t,n.style.webkitTransform=t,n.style["-moz-transform"]=t,n.style["-ms-transform"]=t,n.style["-o-transform"]=t)},getObjectKeys:function(t){var i=[];return t&&n.each(t,function(n){i.push(n)}),i},getObjectSize:function(n){return t.getObjectKeys(n).length},whenAll:function(i){var l=[].slice,u=arguments.length===1&&t.isArray(i)?i:l.call(arguments),f=n.Deferred(),r,a=0,e,o=u.length,s=o,v,y,h,c;for(v=y=h=Array(o),c=function(n,t,i){return function(){i!==u&&a++;f.notifyWith(t[n]=this,i[n]=l.call(arguments));--s||f[(a?"reject":"resolve")+"With"](t,i)}},r=0;r<o;r++)(e=u[r])&&n.isFunction(e.promise)?e.promise().done(c(r,h,u)).fail(c(r,v,y)):(f.notifyWith(this,e),--s);return s||f.resolveWith(h,u),f.promise()}};i=function(i,r){var u=this;(u.$element=n(i),u.$parent=u.$element.parent(),u._validate())&&(u.isPreviewable=t.hasFileAPISupport(),u.isIE9=t.isIE(9),u.isIE10=t.isIE(10),(u.isPreviewable||u.isIE9)&&(u._init(r),u._listen()),u.$element.removeClass("file-loading"))};i.prototype={constructor:i,_cleanup:function(){var n=this;n.reader=null;n.clearFileStack();n.fileBatchCompleted=!0;n.isError=!1;n.isDuplicateError=!1;n.isPersistentError=!1;n.cancelling=!1;n.paused=!1;n.lastProgress=0;n._initAjax()},_isAborted:function(){var n=this;return n.cancelling||n.paused},_initAjax:function(){var r=this,i=r.taskManager={pool:{},addPool:function(n){return i.pool[n]=new i.TasksPool(n)},getPool:function(n){return i.pool[n]},addTask:function(n,t){return new i.Task(n,t)},TasksPool:function(r){var u=this;u.id=r;u.cancelled=!1;u.cancelledDeferrer=n.Deferred();u.tasks={};u.addTask=function(n,t){return u.tasks[n]=new i.Task(n,t)};u.size=function(){return t.getObjectSize(u.tasks)};u.run=function(i){var a=0,c=!1,f,o=t.getObjectKeys(u.tasks).map(function(n){return u.tasks[n]}),e=[],r=n.Deferred(),s,h,l;if(u.cancelled)return u.cancelledDeferrer.resolve(),r.reject();if(!i)return l=t.getObjectKeys(u.tasks).map(function(n){return u.tasks[n].deferred}),t.whenAll(l).done(function(){var n=t.getArray(arguments);u.cancelled?(r.reject.apply(null,n),u.cancelledDeferrer.resolve()):(r.resolve.apply(null,n),u.cancelledDeferrer.reject())}).fail(function(){var n=t.getArray(arguments);r.reject.apply(null,n);u.cancelled?u.cancelledDeferrer.resolve():u.cancelledDeferrer.reject()}),n.each(u.tasks,function(n){f=u.tasks[n];f.run()}),r;for(s=function(t){n.when(t.deferred).fail(function(){c=!0;h.apply(null,arguments)}).always(h)},h=function(){var n=t.getArray(arguments);if(r.notify(n),e.push(n),u.cancelled){r.reject.apply(null,e);u.cancelledDeferrer.resolve();return}e.length===u.size()&&(c?r.reject.apply(null,e):r.resolve.apply(null,e));o.length&&(f=o.shift(),s(f),f.run())};o.length&&a++<i;)f=o.shift(),s(f),f.run();return r};u.cancel=function(){return u.cancelled=!0,u.cancelledDeferrer}},Task:function(i,r){var u=this;u.id=i;u.deferred=n.Deferred();u.logic=r;u.context=null;u.run=function(){var n=t.getArray(arguments);return n.unshift(u.deferred),r.apply(u.context,n),u.deferred};u.runWithContext=function(n){return u.context=n,u.run()}}};r.ajaxQueue=[];r.ajaxRequests=[];r.ajaxAborted=!1},_init:function(i,r){var u=this,s,f=u.$element,e,o,h;u.options=i;u.canOrientImage=t.canOrientImage(f);n.each(i,function(n,i){switch(n){case"minFileCount":case"maxFileCount":case"maxTotalFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":u[n]=t.getNum(i);break;default:u[n]=i}});u.maxTotalFileCount>0&&u.maxTotalFileCount<u.maxFileCount&&(u.maxTotalFileCount=u.maxFileCount);u.rtl&&(h=u.previewZoomButtonIcons.prev,u.previewZoomButtonIcons.prev=u.previewZoomButtonIcons.next,u.previewZoomButtonIcons.next=h);!isNaN(u.maxAjaxThreads)&&u.maxAjaxThreads<u.resumableUploadOptions.maxThreads&&(u.resumableUploadOptions.maxThreads=u.maxAjaxThreads);u._initFileManager();typeof u.autoOrientImage=="function"&&(u.autoOrientImage=u.autoOrientImage());typeof u.autoOrientImageInitial=="function"&&(u.autoOrientImageInitial=u.autoOrientImageInitial());r||u._cleanup();u.duplicateErrors=[];u.$form=f.closest("form");u._initTemplateDefaults();u.uploadFileAttr=t.isEmpty(f.attr("name"))?"file_data":f.attr("name");o=u._getLayoutTemplate("progress");u.progressTemplate=o.replace("{class}",u.progressClass);u.progressInfoTemplate=o.replace("{class}",u.progressInfoClass);u.progressPauseTemplate=o.replace("{class}",u.progressPauseClass);u.progressCompleteTemplate=o.replace("{class}",u.progressCompleteClass);u.progressErrorTemplate=o.replace("{class}",u.progressErrorClass);u.isDisabled=f.attr("disabled")||f.attr("readonly");u.isDisabled&&f.attr("disabled",!0);u.isClickable=u.browseOnZoneClick&&u.showPreview&&(u.dropZoneEnabled||!t.isEmpty(u.defaultPreviewContent));u.isAjaxUpload=t.hasFileUploadSupport()&&!t.isEmpty(u.uploadUrl);u.dropZoneEnabled=t.hasDragDropSupport()&&u.dropZoneEnabled;u.isAjaxUpload||(u.dropZoneEnabled=u.dropZoneEnabled&&t.canAssignFilesToInput());u.slug=typeof i.slugCallback=="function"?i.slugCallback:u._slugDefault;u.mainTemplate=u.showCaption?u._getLayoutTemplate("main1"):u._getLayoutTemplate("main2");u.captionTemplate=u._getLayoutTemplate("caption");u.previewGenericTemplate=u._getPreviewTemplate("generic");!u.imageCanvas&&u.resizeImage&&(u.maxImageWidth||u.maxImageHeight)&&(u.imageCanvas=document.createElement("canvas"),u.imageCanvasContext=u.imageCanvas.getContext("2d"));t.isEmpty(f.attr("id"))&&f.attr("id",t.uniqId());u.namespace=".fileinput_"+f.attr("id").replace(/-/g,"_");u.$container===undefined?u.$container=u._createContainer():u._refreshContainer();e=u.$container;u.$dropZone=e.find(".file-drop-zone");u.$progress=e.find(".kv-upload-progress");u.$btnUpload=e.find(".fileinput-upload");u.$captionContainer=t.getElement(i,"elCaptionContainer",e.find(".file-caption"));u.$caption=t.getElement(i,"elCaptionText",e.find(".file-caption-name"));t.isEmpty(u.msgPlaceholder)||(s=f.attr("multiple")?u.filePlural:u.fileSingle,u.$caption.attr("placeholder",u.msgPlaceholder.replace("{files}",s)));u.$captionIcon=u.$captionContainer.find(".file-caption-icon");u.$previewContainer=t.getElement(i,"elPreviewContainer",e.find(".file-preview"));u.$preview=t.getElement(i,"elPreviewImage",e.find(".file-preview-thumbnails"));u.$previewStatus=t.getElement(i,"elPreviewStatus",e.find(".file-preview-status"));u.$errorContainer=t.getElement(i,"elErrorContainer",u.$previewContainer.find(".kv-fileinput-error"));u._validateDisabled();t.isEmpty(u.msgErrorClass)||t.addCss(u.$errorContainer,u.msgErrorClass);r?u._errorsExist()||u.$errorContainer.hide():(u._resetErrors(),u.$errorContainer.hide(),u.previewInitId="thumb-"+f.attr("id"),u._initPreviewCache(),u._initPreview(!0),u._initPreviewActions(),u.$parent.hasClass("file-loading")&&(u.$container.insertBefore(u.$parent),u.$parent.remove()));u._setFileDropZoneTitle();f.attr("disabled")&&u.disable();u._initZoom();u.hideThumbnailContent&&t.addCss(u.$preview,"hide-content")},_initFileManager:function(){var i=this;i.uploadStartTime=t.now();i.fileManager={stack:{},filesProcessed:[],errors:[],loadedImages:{},totalImages:0,totalFiles:null,totalSize:null,uploadedSize:0,stats:{},initStats:function(n){var r={started:t.now()};n?i.fileManager.stats[n]=r:i.fileManager.stats=r},getUploadStats:function(n,r,u){var f=i.fileManager,s=n?f.stats[n]&&f.stats[n].started||t.now():i.uploadStartTime,e=(t.now()-s)/1e3,h=e?r/e:0,c=i._getSize(h,["B/s","KB/s","MB/s","GB/s","TB/s","PB/s","EB/s","ZB/s","YB/s"]),l=u-r,o={fileId:n,started:s,elapsed:e,loaded:r,total:u,bps:h,bitrate:c,pendingBytes:l};return n?f.stats[n]=o:f.stats=o,o},exists:function(t){return n.inArray(t,i.fileManager.getIdList())!==-1},count:function(){return i.fileManager.getIdList().length},total:function(){var n=i.fileManager;return n.totalFiles||(n.totalFiles=n.count()),n.totalFiles},getTotalSize:function(){var t=i.fileManager;return t.totalSize?t.totalSize:(t.totalSize=0,n.each(i.fileManager.stack,function(n,i){var r=parseFloat(i.size);t.totalSize+=isNaN(r)?0:r}),t.totalSize)},add:function(n,r){(r||(r=i.fileManager.getId(n)),r)&&(i.fileManager.stack[r]={file:n,name:t.getFileName(n),relativePath:t.getFileRelativePath(n),size:n.size,nameFmt:i._getFileName(n,""),sizeFmt:i._getSize(n.size)})},remove:function(n){var t=n.attr("data-fileid");t&&i.fileManager.removeFile(t)},removeFile:function(n){delete i.fileManager.stack[n];delete i.fileManager.loadedImages[n]},move:function(t,r){var u={},f=i.fileManager.stack;(t||r)&&t!==r&&(n.each(f,function(n,i){n!==t&&(u[n]=i);n===r&&(u[t]=f[t])}),i.fileManager.stack=u)},list:function(){var t=[];return n.each(i.fileManager.stack,function(n,i){i&&i.file&&t.push(i.file)}),t},isPending:function(t){return n.inArray(t,i.fileManager.filesProcessed)===-1&&i.fileManager.exists(t)},isProcessed:function(){var t=!0,r=i.fileManager;return n.each(r.stack,function(n){r.isPending(n)&&(t=!1)}),t},clear:function(){var n=i.fileManager;i.isDuplicateError=!1;i.isPersistentError=!1;n.totalFiles=null;n.totalSize=null;n.uploadedSize=0;n.stack={};n.errors=[];n.filesProcessed=[];n.stats={};n.clearImages()},clearImages:function(){i.fileManager.loadedImages={};i.fileManager.totalImages=0},addImage:function(n,t){i.fileManager.loadedImages[n]=t},removeImage:function(n){delete i.fileManager.loadedImages[n]},getImageIdList:function(){return t.getObjectKeys(i.fileManager.loadedImages)},getImageCount:function(){return i.fileManager.getImageIdList().length},getId:function(n){return i._getFileId(n)},getIndex:function(n){return i.fileManager.getIdList().indexOf(n)},getThumb:function(t){var r=null;return i._getThumbs().each(function(){var i=n(this);i.attr("data-fileid")===t&&(r=i)}),r},getThumbIndex:function(n){var t=n.attr("data-fileid");return i.fileManager.getIndex(t)},getIdList:function(){return t.getObjectKeys(i.fileManager.stack)},getFile:function(n){return i.fileManager.stack[n]||null},getFileName:function(n,t){var r=i.fileManager.getFile(n);return r?t?r.nameFmt||"":r.name||"":""},getFirstFile:function(){var n=i.fileManager.getIdList(),t=n&&n.length?n[0]:null;return i.fileManager.getFile(t)},setFile:function(n,t){i.fileManager.getFile(n)?i.fileManager.stack[n].file=t:i.fileManager.add(t,n)},setProcessed:function(n){i.fileManager.filesProcessed.push(n)},getProgress:function(){var n=i.fileManager.total(),t=i.fileManager.filesProcessed.length;return n?Math.ceil(t/n*100):0},setProgress:function(n,t){var r=i.fileManager.getFile(n);!isNaN(t)&&r&&(r.progress=t)}}},_setUploadData:function(i,r){var u=this;n.each(r,function(n,r){var f=u.uploadParamNames[n]||n;t.isArray(r)?i.append(f,r[0],r[1]):i.append(f,r)})},_initResumableUpload:function(){var r=this,f=r.resumableUploadOptions,e=t.logMessages,i,u=r.fileManager;if(r.enableResumableUpload){if(f.fallback!==!1&&typeof f.fallback!="function"&&(f.fallback=function(n){n._log(e.noResumableSupport);n.enableResumableUpload=!1}),!t.hasResumableUploadSupport()&&f.fallback!==!1){f.fallback(r);return}if(!r.uploadUrl&&r.enableResumableUpload){r._log(e.noUploadUrl);r.enableResumableUpload=!1;return}if(f.chunkSize=parseFloat(f.chunkSize),f.chunkSize<=0||isNaN(f.chunkSize)){r._log(e.invalidChunkSize,{chunkSize:f.chunkSize});r.enableResumableUpload=!1;return}i=r.resumableManager={init:function(n,t,e){i.logs=[];i.stack=[];i.error="";i.id=n;i.file=t.file;i.fileName=t.name;i.fileIndex=e;i.completed=!1;i.lastProgress=0;r.showPreview&&(i.$thumb=u.getThumb(n)||null,i.$progress=i.$btnDelete=null,i.$thumb&&i.$thumb.length&&(i.$progress=i.$thumb.find(".file-thumb-progress"),i.$btnDelete=i.$thumb.find(".kv-file-remove")));i.chunkSize=f.chunkSize*1024;i.chunkCount=i.getTotalChunks()},setAjaxError:function(n,t,u,o){n.responseJSON&&n.responseJSON.error&&(u=n.responseJSON.error.toString());o||(i.error=u);f.showErrorLog&&r._log(e.ajaxError,{status:n.status,error:u,text:n.responseText||""})},reset:function(){i.stack=[];i.chunksProcessed={}},setProcessed:function(n){var e=i.id,s,t=i.$thumb,h=i.$progress,c=t&&t.length,o={id:c?t.attr("id"):"",index:u.getIndex(e),fileId:e};i.completed=!0;i.lastProgress=0;c&&t.removeClass("file-uploading");n==="success"?(u.uploadedSize+=i.file.size,r.showPreview&&(r._setProgress(101,h),r._setThumbStatus(t,"Success"),r._initUploadSuccess(i.chunksProcessed[e].data,t)),u.removeFile(e),delete i.chunksProcessed[e],r._raise("fileuploaded",[o.id,o.index,o.fileId]),u.isProcessed()&&r._setProgress(101)):n!=="cancel"&&(r.showPreview&&(r._setThumbStatus(t,"Error"),r._setPreviewError(t,!0),r._setProgress(101,h,r.msgProgressError),r._setProgress(101,r.$progress,r.msgProgressError),r.cancelling=!0),r.$errorContainer.find('li[data-file-id="'+o.fileId+'"]').length||(s=r.msgResumableUploadRetriesExceeded.setTokens({file:i.fileName,max:f.maxRetries,error:i.error}),r._showFileError(s,o)));u.isProcessed()&&i.reset()},check:function(){var t=!0;n.each(i.logs,function(n,i){if(!i)return t=!1,!1})},processedResumables:function(){var n=i.logs,t,r=0;if(!n||!n.length)return 0;for(t=0;t<n.length;t++)n[t]===!0&&r++;return r},getUploadedSize:function(){var n=i.processedResumables()*i.chunkSize;return n>i.file.size?i.file.size:n},getTotalChunks:function(){var n=parseFloat(i.chunkSize);return!isNaN(n)&&n>0?Math.ceil(i.file.size/n):0},getProgress:function(){var t=i.processedResumables(),n=i.chunkCount;return n===0?0:Math.ceil(t/n*100)},checkAborted:function(n){r._isAborted()&&(clearInterval(n),r.unlock())},upload:function(){var e=u.getIdList(),n="new",f;f=setInterval(function(){var o,s;i.checkAborted(f);n==="new"&&(r.lock(),n="processing",o=e.shift(),u.initStats(o),u.stack[o]&&(i.init(o,u.stack[o],u.getIndex(o)),i.processUpload()));!u.isPending(o)&&i.completed&&(n="new");u.isProcessed()&&(s=r.$preview.find(".file-preview-initial"),s.length&&(t.addCss(s,t.SORT_CSS),r._initSortable()),clearInterval(f),r._clearFileInput(),r.unlock(),setTimeout(function(){var n=r.previewCache.data;n&&(r.initialPreview=n.content,r.initialPreviewConfig=n.config,r.initialPreviewThumbTags=n.tags);r._raise("filebatchuploadcomplete",[r.initialPreview,r.initialPreviewConfig,r.initialPreviewThumbTags,r._getExtraData()])},r.processDelay))},r.processDelay)},uploadResumable:function(){for(var u=r.taskManager,e=i.chunkCount,t=u.addPool(i.id),n=0;n<e;n++)i.logs[n]=!!(i.chunksProcessed[i.id]&&i.chunksProcessed[i.id][n]),i.logs[n]||i.pushAjax(n,0);t.run(f.maxThreads).done(function(){i.setProcessed("success")}).fail(function(){i.setProcessed(t.cancelled?"cancel":"error")})},processUpload:function(){var o,h,e=i.id,c,l,a,v,s;if(!f.testUrl){i.uploadResumable();return}o=new FormData;h=u.stack[e];r._setUploadData(o,{fileId:e,fileName:h.fileName,fileSize:h.size,fileRelativePath:h.relativePath,chunkSize:i.chunkSize,chunkCount:i.chunkCount});c=function(n){s=r._getOutData(o,n);r._raise("filetestbeforesend",[e,u,i,s])};l=function(f,h,c){s=r._getOutData(o,c,f);var v=r.uploadParamNames,l=v.chunksUploaded||"chunksUploaded",a=[e,u,i,s];f[l]&&t.isArray(f[l])?(i.chunksProcessed[e]||(i.chunksProcessed[e]={}),n.each(f[l],function(n,t){i.logs[t]=!0;i.chunksProcessed[e][t]=!0}),i.chunksProcessed[e].data=f,r._raise("filetestsuccess",a)):r._raise("filetesterror",a);i.uploadResumable()};a=function(n,t,f){s=r._getOutData(o,n);r._raise("filetestajaxerror",[e,u,i,s]);i.setAjaxError(n,t,f,!0);i.uploadResumable()};v=function(){r._raise("filetestcomplete",[e,u,i,r._getOutData(o)])};r._ajaxSubmit(c,l,v,a,o,e,i.fileIndex,f.testUrl)},pushAjax:function(n,t){var f=r.taskManager,u=f.getPool(i.id);u.addTask(u.size()+1,function(n){var u=i.stack.shift(),t;t=u[0];i.chunksProcessed[i.id]&&i.chunksProcessed[i.id][t]?r._log(e.chunkQueueError,{index:t}):i.sendAjax(t,u[1],n)});i.stack.push([n,t])},sendAjax:function(n,o,s){var b,v=i.chunkSize,h=i.id,a=i.file,w=i.$thumb,y=t.logMessages,rt=i.$btnDelete,p=function(n,t){t&&(n=n.setTokens(t));n="Error processing resumable ajax request. "+n;r._log(n);s.reject(n)},c,l,k,d,g,nt,tt,it;if(!i.chunksProcessed[h]||!i.chunksProcessed[h][n]){if(o>f.maxRetries){p(y.resumableMaxRetriesReached,{n:f.maxRetries});i.setProcessed("error");return}tt=a.slice?"slice":a.mozSlice?"mozSlice":a.webkitSlice?"webkitSlice":"slice";it=a[tt](v*n,v*(n+1));c=new FormData;b=u.stack[h];r._setUploadData(c,{chunkCount:i.chunkCount,chunkIndex:n,chunkSize:v,chunkSizeStart:v*n,fileBlob:[it,i.fileName],fileId:h,fileName:i.fileName,fileRelativePath:b.relativePath,fileSize:a.size,retryCount:o});i.$progress&&i.$progress.length&&i.$progress.show();k=function(f){l=r._getOutData(c,f);r.showPreview&&(w.hasClass("file-preview-success")||(r._setThumbStatus(w,"Loading"),t.addCss(w,"file-uploading")),rt.attr("disabled",!0));r._raise("filechunkbeforesend",[h,n,o,u,i,l])};d=function(t,a,v){if(r._isAborted()){p(y.resumableAborting);return}l=r._getOutData(c,v,t);var k=r.uploadParamNames,w=k.chunkIndex||"chunkIndex",b=[h,n,o,u,i,l];t.error?(f.showErrorLog&&r._log(e.retryStatus,{retry:o+1,filename:i.fileName,chunk:n}),i.pushAjax(n,o+1),i.error=t.error,r._raise("filechunkerror",b)):(i.logs[t[w]]=!0,i.chunksProcessed[h]||(i.chunksProcessed[h]={}),i.chunksProcessed[h][t[w]]=!0,i.chunksProcessed[h].data=t,s.resolve.call(null,t),r._raise("filechunksuccess",b),i.check())};g=function(t,f,e){if(r._isAborted()){p(y.resumableAborting);return}l=r._getOutData(c,t);i.setAjaxError(t,f,e);r._raise("filechunkajaxerror",[h,n,o,u,i,l]);i.pushAjax(n,o+1);p(y.resumableRetryError,{n:o-1})};nt=function(){r._isAborted()||r._raise("filechunkcomplete",[h,n,o,u,i,r._getOutData(c)])};r._ajaxSubmit(k,d,nt,g,c,h,i.fileIndex)}}};i.reset()}},_initTemplateDefaults:function(){var r=this,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,f,ot,st,ht,ct,lt,at,vt,yt,pt,wt,bt,kt,dt,e,gt,i,ni,u,ti;o='{preview}\n<div class="kv-upload-progress kv-hidden"><\/div><div class="clearfix"><\/div>\n<div class="input-group {class}">\n  {caption}\n<div class="input-group-btn input-group-append">\n      {remove}\n      {cancel}\n      {pause}\n      {upload}\n      {browse}\n    <\/div>\n<\/div>';s='{preview}\n<div class="kv-upload-progress kv-hidden"><\/div>\n<div class="clearfix"><\/div>\n{remove}\n{cancel}\n{upload}\n{browse}\n';h='<div class="file-preview {class}">\n  {close}  <div class="{dropClass} clearfix">\n    <div class="file-preview-thumbnails clearfix">\n    <\/div>\n    <div class="file-preview-status text-center text-success"><\/div>\n    <div class="kv-fileinput-error"><\/div>\n  <\/div>\n<\/div>';l=t.closeButton("fileinput-remove");c='<i class="glyphicon glyphicon-file"><\/i>';a='<div class="file-caption form-control {class}" tabindex="500">\n  <span class="file-caption-icon"><\/span>\n  <input class="file-caption-name" onkeydown="return false;" onpaste="return false;">\n<\/div>';v='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}<\/button>';y='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}<\/a>';p='<div tabindex="500" class="{css}" {status}>{icon} {label}<\/div>';w='<div id="'+t.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+t.MODAL_ID+'Label"><\/div>';b='<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h5 class="modal-title">{heading}<\/h5>\n      <span class="kv-zoom-title"><\/span>\n      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}<\/div>\n    <\/div>\n    <div class="modal-body">\n      <div class="floating-buttons"><\/div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"><\/div>\n{prev} {next}\n    <\/div>\n  <\/div>\n<\/div>\n';k='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     <\/div>\n<\/div>{stats}';ti='<div class="text-info file-upload-stats"><span class="pending-time">{pendingTime}<\/span> <span class="upload-speed">{uploadSpeed}<\/span><\/div>';d=" <samp>({sizeText})<\/samp>";g='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}<\/div>\n        <div class="file-size-info">{size}<\/div>\n    <\/div>\n    {progress}\n{indicator}\n{actions}\n<\/div>';nt='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {download} {upload} {delete} {zoom} {other}    <\/div>\n<\/div>\n{drag}\n<div class="clearfix"><\/div>';tt='<button type="button" class="fa fa-edit kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}<\/button>\n';it='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}<\/button>';rt='<a class="kv-file-download {downloadClass}" title="{downloadTitle}" href="{downloadUrl}" download="{caption}" target="_blank">{downloadIcon}<\/a>';ut='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}<\/button>';ft='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}<\/span>';et='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}<\/div>';f='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-fileid="{fileid}" data-template="{template}"';ot=f+'><div class="kv-file-content">\n';st=f+' title="{caption}"><div class="kv-file-content">\n';ht="<\/div>{footer}\n{zoomCache}<\/div>\n";ct="{content}\n";i=" {style}";lt='<div class="kv-preview-data file-preview-html" title="{caption}"'+i+">{data}<\/div>\n";at='<img src="{data}" class="file-preview-image kv-preview-data" title="{title}" alt="{alt}"'+i+">\n";vt='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly'+i+">{data}<\/textarea>\n";yt='<iframe class="kv-preview-data file-preview-office" src="https://view.officeapps.live.com/op/embed.aspx?src={data}"'+i+"><\/iframe>";pt='<iframe class="kv-preview-data file-preview-gdocs" src="https://docs.google.com/gview?url={data}&embedded=true"'+i+"><\/iframe>";wt='<video class="kv-preview-data file-preview-video" controls'+i+'>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n<\/video>\n";bt='<!--suppress ALL --><audio class="kv-preview-data file-preview-audio" controls'+i+'>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n<\/audio>\n";kt='<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash"'+i+">\n";e='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf"'+i+">\n";dt='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}"'+i+'>\n<param name="movie" value="{caption}" />\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n<\/object>\n";gt='<div class="kv-preview-data file-preview-other-frame"'+i+">\n"+t.DEFAULT_PREVIEW+"\n<\/div>\n";ni='<div class="kv-zoom-cache" style="display:none">{zoomContent}<\/div>';u={width:"100%",height:"100%","min-height":"480px"};r._isPdfRendered()&&(e=r.pdfRendererTemplate.replace("{renderer}",r._encodeURI(r.pdfRendererUrl)));r.defaults={layoutTemplates:{main1:o,main2:s,preview:h,close:l,fileIcon:c,caption:a,modalMain:w,modal:b,progress:k,stats:ti,size:d,footer:g,indicator:et,actions:nt,actionDelete:tt,actionUpload:it,actionDownload:rt,actionZoom:ut,actionDrag:ft,btnDefault:v,btnLink:y,btnBrowse:p,zoomCache:ni},previewMarkupTags:{tagBefore1:ot,tagBefore2:st,tagAfter:ht},previewContentTemplates:{generic:ct,html:lt,image:at,text:vt,office:yt,gdocs:pt,video:wt,audio:bt,flash:kt,object:dt,pdf:e,other:gt},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},office:{width:"213px",height:"160px"},gdocs:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"100%",height:"160px",position:"relative"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},office:{width:"100%",height:"160px"},gdocs:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:u,text:u,office:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},gdocs:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:u,other:{width:"auto",height:"100%","min-height":"480px"}},mimeTypeAliases:{"video/quicktime":"video/mp4"},fileTypeSettings:{image:function(n,i){return t.compare(n,"image.*")&&!t.compare(n,/(tiff?|wmf)$/i)||t.compare(i,/\.(gif|png|jpe?g)$/i)},html:function(n,i){return t.compare(n,"text/html")||t.compare(i,/\.(htm|html)$/i)},office:function(n,i){return t.compare(n,/(word|excel|powerpoint|office)$/i)||t.compare(i,/\.(docx?|xlsx?|pptx?|pps|potx?)$/i)},gdocs:function(n,i){return t.compare(n,/(word|excel|powerpoint|office|iwork-pages|tiff?)$/i)||t.compare(i,/\.(docx?|xlsx?|pptx?|pps|potx?|rtf|ods|odt|pages|ai|dxf|ttf|tiff?|wmf|e?ps)$/i)},text:function(n,i){return t.compare(n,"text.*")||t.compare(i,/\.(xml|javascript)$/i)||t.compare(i,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(n,i){return t.compare(n,"video.*")&&(t.compare(n,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||t.compare(i,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(n,i){return t.compare(n,"audio.*")&&(t.compare(i,/(ogg|mp3|mp?g|wav)$/i)||t.compare(i,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(n,i){return t.compare(n,"application/x-shockwave-flash",!0)||t.compare(i,/\.(swf)$/i)},pdf:function(n,i){return t.compare(n,"application/pdf",!0)||t.compare(i,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash"><\/i>',removeClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"><\/i>',uploadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"><\/i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"><\/i>',downloadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"><\/i>',zoomClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"><\/i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"><\/i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"><\/i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"><\/i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"><\/i>',indicatorPaused:'<i class="glyphicon glyphicon-pause text-primary"><\/i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading &hellip;",indicatorPausedTitle:"Upload Paused"}};n.each(r.defaults,function(t,i){if(t==="allowedPreviewTypes"){r.allowedPreviewTypes===undefined&&(r.allowedPreviewTypes=i);return}r[t]=n.extend(!0,{},i,r[t])});r._initPreviewTemplates()},_initPreviewTemplates:function(){var i=this,u=i.previewMarkupTags,r,f=u.tagAfter;n.each(i.previewContentTemplates,function(n,e){t.isEmpty(i.previewTemplates[n])&&(r=u.tagBefore2,(n==="generic"||n==="image"||n==="html"||n==="text")&&(r=u.tagBefore1),i._isPdfRendered()&&n==="pdf"&&(r=r.replace("kv-file-content","kv-file-content kv-pdf-rendered")),i.previewTemplates[n]=r+e+f)})},_initPreviewCache:function(){var i=this;i.previewCache={data:{},init:function(){var n=i.initialPreview;n.length>0&&!t.isArray(n)&&(n=n.split(i.initialPreviewDelimiter));i.previewCache.data={content:n,config:i.initialPreviewConfig,tags:i.initialPreviewThumbTags}},count:function(n){if(!i.previewCache.data||!i.previewCache.data.content)return 0;if(n){var t=i.previewCache.data.content.filter(function(n){return n!==null});return t.length}return i.previewCache.data.content.length},get:function(n,r){var y=t.INIT_FLAG+n,f=i.previewCache.data,u=f.config[n],o=f.content[n],e,s,h,c,l,a,v,w=t.ifSet("previewAsData",u,i.initialPreviewAsData),b=u?{title:u.title||null,alt:u.alt||null}:{title:null,alt:null},p=function(n,r,f,e,o,s,h,c){var a=" file-preview-initial "+t.SORT_CSS+(h?" "+h:""),l=i.previewInitId+"-"+s,v=u&&u.fileId||l;return i._generatePreviewTemplate(n,r,f,e,l,v,!1,null,a,o,s,c,b,u&&u.zoomData||r)};return!o||!o.length?"":(r=r===undefined?!0:r,h=t.ifSet("type",u,i.initialPreviewFileType||"generic"),l=t.ifSet("filename",u,t.ifSet("caption",u)),a=t.ifSet("filetype",u,h),c=i.previewCache.footer(n,r,u&&u.size||null),v=t.ifSet("frameClass",u),e=w?p(h,o,l,a,c,y,v):p("generic",o,l,a,c,y,v,h).setTokens({content:f.content[n]}),f.tags.length&&f.tags[n]&&(e=t.replaceTags(e,f.tags[n])),t.isEmpty(u)||t.isEmpty(u.frameAttr)||(s=t.createElement(e),s.find(".file-preview-initial").attr(u.frameAttr),e=s.html(),s.remove()),e)},clean:function(n){n.content=t.cleanArray(n.content);n.config=t.cleanArray(n.config);n.tags=t.cleanArray(n.tags);i.previewCache.data=n},add:function(n,r,u,f){var e=i.previewCache.data,o;return!n||!n.length?0:(o=n.length-1,t.isArray(n)||(n=n.split(i.initialPreviewDelimiter)),f&&e.content?(o=e.content.push(n[0])-1,e.config[o]=r,e.tags[o]=u):(e.content=n,e.config=r,e.tags=u),i.previewCache.clean(e),o)},set:function(n,r,u,f){var o=i.previewCache.data,e,s;if(n&&n.length&&(t.isArray(n)||(n=n.split(i.initialPreviewDelimiter)),s=n.filter(function(n){return n!==null}),s.length)){if(o.content===undefined&&(o.content=[]),o.config===undefined&&(o.config=[]),o.tags===undefined&&(o.tags=[]),f){for(e=0;e<n.length;e++)n[e]&&o.content.push(n[e]);for(e=0;e<r.length;e++)r[e]&&o.config.push(r[e]);for(e=0;e<u.length;e++)u[e]&&o.tags.push(u[e])}else o.content=n,o.config=r,o.tags=u;i.previewCache.clean(o)}},unset:function(r){var f=i.previewCache.count(),u=i.reversePreviewOrder,e;if(f){if(f===1){i.previewCache.data.content=[];i.previewCache.data.config=[];i.previewCache.data.tags=[];i.initialPreview=[];i.initialPreviewConfig=[];i.initialPreviewThumbTags=[];return}i.previewCache.data.content=t.spliceArray(i.previewCache.data.content,r,u);i.previewCache.data.config=t.spliceArray(i.previewCache.data.config,r,u);i.previewCache.data.tags=t.spliceArray(i.previewCache.data.tags,r,u);e=n.extend(!0,{},i.previewCache.data);i.previewCache.clean(e)}},out:function(){var n="",f,r=i.previewCache.count(),t,u;if(r===0)return{content:"",caption:""};for(t=0;t<r;t++)u=i.previewCache.get(t),n=i.reversePreviewOrder?u+n:n+u;return f=i._getMsgSelected(r),{content:n,caption:f}},footer:function(n,r,u){var e=i.previewCache.data||{};if(t.isEmpty(e.content))return"";(t.isEmpty(e.config)||t.isEmpty(e.config[n]))&&(e.config[n]={});r=r===undefined?!0:r;var f=e.config[n],y=t.ifSet("caption",f),c,p=t.ifSet("width",f,"auto"),l=t.ifSet("url",f,!1),a=t.ifSet("key",f,null),v=t.ifSet("fileId",f,null),o=i.fileActionSettings,w=i.initialPreviewShowDelete||!1,b=i.initialPreviewDownloadUrl?i.initialPreviewDownloadUrl+"?key="+a+(v?"&fileId="+v:""):"",s=f.downloadUrl||b,k=f.filename||f.caption||"",d=!!s,g=t.ifSet("showRemove",f,w),h=t.ifSet("showDownload",f,t.ifSet("showDownload",o,d)),nt=t.ifSet("showZoom",f,t.ifSet("showZoom",o,!0)),tt=t.ifSet("showDrag",f,t.ifSet("showDrag",o,!0)),it=l===!1&&r;return h=h&&f.downloadUrl!==!1&&!!s,c=i._renderFileActions(f,!1,h,g,nt,tt,it,l,a,!0,s,k),i._getLayoutTemplate("footer").setTokens({progress:i._renderThumbProgress(),actions:c,caption:y,size:i._getSize(u),width:p,indicator:""})}};i.previewCache.init()},_isPdfRendered:function(){var t=this,n=t.usePdfRenderer,i=typeof n=="function"?n():!!n;return i&&t.pdfRendererUrl},_handler:function(n,t,i){var f=this,r=f.namespace,u=t.split(" ").join(r+" ")+r;if(n&&n.length)n.off(u).on(u,i)},_encodeURI:function(n){var t=this;return t.encodeUrl?encodeURI(n):n},_log:function(n,t){var i=this,r=i.$element.attr("id");i.showConsoleLogs&&(r&&(n='"'+r+'": '+n),n="bootstrap-fileinput: "+n,typeof t=="object"&&(n=n.setTokens(t)),window.console&&typeof window.console.log!="undefined"?window.console.log(n):window.alert(n))},_validate:function(){var n=this,i=n.$element.attr("type")==="file";return i||n._log(t.logMessages.badInputType),i},_errorsExist:function(){var r=this,i,u=r.$errorContainer.find("li");return u.length?!0:(i=t.createElement(r.$errorContainer.html()),i.find(".kv-error-close").remove(),i.find("ul").remove(),!!n.trim(i.text()).length)},_errorHandler:function(n,t){var r=this,i=n.target.error,u=function(n){r._showError(n.replace("{name}",t))};i.code===i.NOT_FOUND_ERR?u(r.msgFileNotFound):i.code===i.SECURITY_ERR?u(r.msgFileSecured):i.code===i.NOT_READABLE_ERR?u(r.msgFileNotReadable):i.code===i.ABORT_ERR?u(r.msgFilePreviewAborted):u(r.msgFilePreviewError)},_addError:function(n){var i=this,r=i.$errorContainer;n&&r.length&&(t.setHtml(r,i.errorCloseButton+n),i._handler(r.find(".kv-error-close"),"click",function(){setTimeout(function(){i.showPreview&&!i.getFrames().length&&i.clear();r.fadeOut("slow")},i.processDelay)}))},_setValidationError:function(n){var i=this;n=(n?n+" ":"")+"has-error";i.$container.removeClass(n).addClass("has-error");t.addCss(i.$captionContainer,"is-invalid")},_resetErrors:function(n){var t=this,i=t.$errorContainer;t.isPersistentError||(t.isError=!1,t.$container.removeClass("has-error"),t.$captionContainer.removeClass("is-invalid"),i.html(""),n?i.fadeOut("slow"):i.hide())},_showFolderError:function(n){var t=this,r=t.$errorContainer,i;n&&(t.isAjaxUpload||t._clearFileInput(),i=t.msgFoldersNotAllowed.replace("{n}",n),t._addError(i),t._setValidationError(),r.fadeIn(t.fadeDelay),t._raise("filefoldererror",[n,i]))},_showFileError:function(n,t,i){var r=this,u=r.$errorContainer,e=i||"fileuploaderror",o=t&&t.fileId||"",f=t&&t.id?'<li data-thumb-id="'+t.id+'" data-file-id="'+o+'">'+n+"<\/li>":"<li>"+n+"<\/li>";return u.find("ul").length===0?r._addError("<ul>"+f+"<\/ul>"):u.find("ul").append(f),u.fadeIn(r.fadeDelay),r._raise(e,[t,n]),r._setValidationError("file-input-new"),!0},_showError:function(n,t,i){var r=this,u=r.$errorContainer,f=i||"fileerror";return t=t||{},t.reader=r.reader,r._addError(n),u.fadeIn(r.fadeDelay),r._raise(f,[t,n]),r.isAjaxUpload||r._clearFileInput(),r._setValidationError("file-input-new"),r.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(n){var t=this,u=t.minFileCount>1?t.filePlural:t.fileSingle,i=t.msgFilesTooLess.replace("{n}",t.minFileCount).replace("{files}",u),r=t.$errorContainer;i="<li>"+i+"<\/li>";r.find("ul").length===0?t._addError("<ul>"+i+"<\/ul>"):r.find("ul").append(i);t.isError=!0;t._updateFileDetails(0);r.fadeIn(t.fadeDelay);t._raise("fileerror",[n,i]);t._clearFileInput();t._setValidationError()},_parseError:function(t,i,r,u){var o=this,f=n.trim(r+""),h,s,e;return s=i.responseJSON&&i.responseJSON.error?i.responseJSON.error.toString():"",e=s?s:i.responseText,o.cancelling&&o.msgUploadAborted&&(f=o.msgUploadAborted),o.showAjaxErrorDetails&&e&&(s?f=n.trim(s+""):(e=n.trim(e.replace(/\n\s*\n/g,"\n")),h=e.length?"<pre>"+e+"<\/pre>":"",f+=f?h:e)),f||(f=o.msgAjaxError.replace("{operation}",t)),o.cancelling=!1,u?"<b>"+u+": <\/b>"+f:f},_parseFileType:function(n,i){var e=this,o,u,f,r,s=e.allowedPreviewTypes||[];if(n==="application/text-plain")return"text";for(r=0;r<s.length;r++)if(f=s[r],o=e.fileTypeSettings[f],u=o(n,i)?f:"",!t.isEmpty(u))return u;return"other"},_getPreviewIcon:function(t){var i=this,r,u=null;return t&&t.indexOf(".")>-1&&(r=t.split(".").pop(),i.previewFileIconSettings&&(u=i.previewFileIconSettings[r]||i.previewFileIconSettings[r.toLowerCase()]||null),i.previewFileExtSettings&&n.each(i.previewFileExtSettings,function(n,t){if(i.previewFileIconSettings[n]&&t(r)){u=i.previewFileIconSettings[n];return}})),u||i.previewFileIcon},_parseFilePreviewIcon:function(n,t){var r=this,u=r._getPreviewIcon(t),i=n;return i.indexOf("{previewFileIcon}")>-1&&(i=i.setTokens({previewFileIconClass:r.previewFileIconClass,previewFileIcon:u})),i},_raise:function(t,i){var u=this,r=n.Event(t);if(i!==undefined?u.$element.trigger(r,i):u.$element.trigger(r),r.isDefaultPrevented()||r.result===!1)return!1;switch(t){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:u.ajaxAborted||(u.ajaxAborted=r.result)}return!0},_listenFullScreen:function(n){var u=this,t=u.$modal,r,i;t&&t.length&&(r=t&&t.find(".btn-fullscreen"),i=t&&t.find(".btn-borderless"),r.length&&i.length)&&(r.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),n?r.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true"),t.hasClass("file-zoom-fullscreen")?u._maximizeZoomDialog():n?u._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false"))},_listen:function(){var i=this,r=i.$element,f=i.$form,u=i.$container,e;i._handler(r,"click",function(n){r.hasClass("file-no-browse")&&(r.data("zoneClicked")?r.data("zoneClicked",!1):n.preventDefault())});i._handler(r,"change",n.proxy(i._change,i));i.showBrowse&&i._handler(i.$btnFile,"click",n.proxy(i._browse,i));i._handler(u.find(".fileinput-remove:not([disabled])"),"click",n.proxy(i.clear,i));i._handler(u.find(".fileinput-cancel"),"click",n.proxy(i.cancel,i));i._handler(u.find(".fileinput-pause"),"click",n.proxy(i.pause,i));i._initDragDrop();i._handler(f,"reset",n.proxy(i.clear,i));i.isAjaxUpload||i._handler(f,"submit",n.proxy(i._submitForm,i));i._handler(i.$container.find(".fileinput-upload"),"click",n.proxy(i._uploadClick,i));i._handler(n(window),"resize",function(){i._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});e="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";i._handler(n(document),e,function(){i._listenFullScreen(t.checkFullScreen())});i._autoFitContent();i._initClickable();i._refreshPreview()},_autoFitContent:function(){var r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=this,u=r<400?t.previewSettingsSmall||t.defaults.previewSettingsSmall:t.previewSettings||t.defaults.previewSettings,i;n.each(u,function(n,r){i=".file-preview-frame .file-preview-"+n;t.$preview.find(i+".kv-preview-data,"+i+" .kv-preview-data").css(r)})},_scanDroppedItems:function(n,i,r){r=r||"";var f=this,u,o,e,s=function(n){f._log(t.logMessages.badDroppedFiles);f._log(n)};n.isFile?n.file(function(n){r&&(n.newPath=r+n.name);i.push(n)},s):n.isDirectory&&(o=n.createReader(),e=function(){o.readEntries(function(t){if(t&&t.length>0){for(u=0;u<t.length;u++)f._scanDroppedItems(t[u],i,r+n.name+"/");e()}return null},s)},e())},_initDragDrop:function(){var t=this,i=t.$dropZone;t.dropZoneEnabled&&t.showPreview&&(t._handler(i,"dragenter dragover",n.proxy(t._zoneDragEnter,t)),t._handler(i,"dragleave",n.proxy(t._zoneDragLeave,t)),t._handler(i,"drop",n.proxy(t._zoneDrop,t)),t._handler(n(document),"dragenter dragover drop",t._zoneDragDropInit))},_zoneDragDropInit:function(n){n.stopPropagation();n.preventDefault()},_zoneDragEnter:function(i){var r=this,u=i.originalEvent.dataTransfer,f=n.inArray("Files",u.types)>-1;if(r._zoneDragDropInit(i),r.isDisabled||!f){i.originalEvent.dataTransfer.effectAllowed="none";i.originalEvent.dataTransfer.dropEffect="none";return}r._raise("fileDragEnter",{sourceEvent:i,files:u.types.Files})&&t.addCss(r.$dropZone,"file-highlighted")},_zoneDragLeave:function(n){var t=this;(t._zoneDragDropInit(n),t.isDisabled)||t._raise("fileDragLeave",{sourceEvent:n})&&t.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(n){var i=this,u,o=i.$element,s=n.originalEvent.dataTransfer,r=s.files,f=s.items,h=t.getDragDropFolders(f),c=function(){i.isAjaxUpload?i._change(n,r):(i.changeTriggered=!0,o.get(0).files=r,setTimeout(function(){i.changeTriggered=!1;o.trigger("change"+i.namespace)},i.processDelay));i.$dropZone.removeClass("file-highlighted")},e;if((n.preventDefault(),!i.isDisabled&&!t.isEmpty(r))&&i._raise("fileDragDrop",{sourceEvent:n,files:r}))if(h>0){if(!i.isAjaxUpload){i._showFolderError(h);return}for(r=[],u=0;u<f.length;u++)e=f[u].webkitGetAsEntry(),e&&i._scanDroppedItems(e,r);setTimeout(function(){c()},500)}else c()},_uploadClick:function(n){var r=this,i=r.$container.find(".fileinput-upload"),u,f=!i.hasClass("disabled")&&t.isEmpty(i.attr("disabled"));if(!n||!n.isDefaultPrevented()){if(!r.isAjaxUpload){f&&i.attr("type")!=="submit"&&(u=i.closest("form"),u.length&&u.trigger("submit"),n.preventDefault());return}n.preventDefault();f&&r.upload()}},_submitForm:function(){var n=this;return n._isFileSelectionValid()&&!n._abort({})},_clearPreview:function(){var t=this,i=t.showUploadedThumbs?t.getFrames(":not(.file-preview-success)"):t.getFrames();i.each(function(){var t=n(this);t.remove()});t.getFrames().length&&t.showPreview||t._resetUpload();t._validateDefaultPreview()},_initSortable:function(){var i=this,o=i.$preview,r,s="."+t.SORT_CSS,u,h=n("body"),c=n("html"),l=i.reversePreviewOrder,a=window.Sortable,f,e;a&&o.find(s).length!==0&&(u=h.length?h:c.length?c:i.$container,f=function(){u.addClass("file-grabbing")},e=function(){u.removeClass("file-grabbing")},r={handle:".drag-handle-init",dataIdAttr:"data-fileid",animation:600,draggable:s,scroll:!1,forceFallback:!0,onChoose:f,onStart:f,onUnchoose:e,onEnd:e,onSort:function(r){var f=r.oldIndex,u=r.newIndex,h=0,e=i.initialPreviewConfig.length,c=e>0&&u>=e,o=n(r.item),s;c&&(u=e-1);i.initialPreview=t.moveArray(i.initialPreview,f,u,l);i.initialPreviewConfig=t.moveArray(i.initialPreviewConfig,f,u,l);i.previewCache.init();i.getFrames(".file-preview-initial").each(function(){n(this).attr("data-fileindex",t.INIT_FLAG+h);h++});c&&(s=i.getFrames(":not(.file-preview-initial):first"),s.length&&o.slideUp(function(){o.insertBefore(s).slideDown()}));i._raise("filesorted",{previewId:o.attr("id"),oldIndex:f,newIndex:u,stack:i.initialPreviewConfig})}},n.extend(!0,r,i.fileActionSettings.dragSettings),i.sortable&&i.sortable.destroy(),i.sortable=a.create(o[0],r))},_setPreviewContent:function(n){var i=this;t.setHtml(i.$preview,n);i._autoFitContent()},_initPreviewImageOrientations:function(){var t=this,i=0,r=t.canOrientImage;(t.autoOrientImageInitial||r)&&t.getFrames(".file-preview-initial").each(function(){var f=n(this),e,o,s,u=t.initialPreviewConfig[i];u&&u.exif&&u.exif.Orientation&&(s=f.attr("id"),e=f.find(">.kv-file-content img"),o=t._getZoom(s," >.kv-file-content img"),r?e.css("image-orientation",t.autoOrientImageInitial?"from-image":"none"):t.setImageOrientation(e,o,u.exif.Orientation,f));i++})},_initPreview:function(n){var i=this,u=i.initialCaption||"",r;if(!i.previewCache.count(!0)){i._clearPreview();n?i._setCaption(u):i._initCaption();return}r=i.previewCache.out();u=n&&i.initialCaption?i.initialCaption:r.caption;i._setPreviewContent(r.content);i._setInitThumbAttr();i._setCaption(u);i._initSortable();t.isEmpty(r.content)||i.$container.removeClass("file-input-new");i._initPreviewImageOrientations()},_getZoomButton:function(n){var t=this,r=t.previewZoomButtonIcons[n],u=t.previewZoomButtonClasses[n],f=' title="'+(t.previewZoomButtonTitles[n]||"")+'" ',i=f+(n==="close"?' data-dismiss="modal" aria-hidden="true"':"");return(n==="fullscreen"||n==="borderless"||n==="toggleheader")&&(i+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+u+" btn-"+n+'"'+i+">"+r+"<\/button>"},_getModalContent:function(){var n=this;return n._getLayoutTemplate("modal").setTokens({rtl:n.rtl?" kv-rtl":"",zoomFrameClass:n.frameClass,heading:n.msgZoomModalHeading,prev:n._getZoomButton("prev"),next:n._getZoomButton("next"),toggleheader:n._getZoomButton("toggleheader"),fullscreen:n._getZoomButton("fullscreen"),borderless:n._getZoomButton("borderless"),close:n._getZoomButton("close")})},_listenModalEvent:function(n){var r=this,i=r.$modal,u=function(n){return{sourceEvent:n,previewId:i.data("previewId"),modal:i}};i.on(n+".bs.modal",function(f){var e=i.find(".btn-fullscreen"),o=i.find(".btn-borderless");i.data("fileinputPluginId")===r.$element.attr("id")&&r._raise("filezoom"+n,u(f));n==="shown"&&(o.removeClass("active").attr("aria-pressed","false"),e.removeClass("active").attr("aria-pressed","false"),i.hasClass("file-zoom-fullscreen")&&(r._maximizeZoomDialog(),t.checkFullScreen()?e.addClass("active").attr("aria-pressed","true"):o.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var i=this,r,f=i._getLayoutTemplate("modalMain"),u="#"+t.MODAL_ID;i.showPreview&&(i.$modal=n(u),i.$modal&&i.$modal.length||(r=t.createElement(t.cspBuffer.stash(f)).insertAfter(i.$container),i.$modal=n(u).insertBefore(r),t.cspBuffer.apply(i.$modal),r.remove()),t.initModal(i.$modal),i.$modal.html(t.cspBuffer.stash(i._getModalContent())),t.cspBuffer.apply(i.$modal),n.each(t.MODAL_EVENTS,function(n,t){i._listenModalEvent(t)}))},_initZoomButtons:function(){var t=this,o=t.$modal.data("previewId")||"",f,e,i=t.getFrames().toArray(),s=i.length,r=t.$modal.find(".btn-prev"),u=t.$modal.find(".btn-next");if(i.length<2){r.hide();u.hide();return}(r.show(),u.show(),s)&&(f=n(i[0]),e=n(i[s-1]),r.removeAttr("disabled"),u.removeAttr("disabled"),f.length&&f.attr("id")===o&&r.attr("disabled",!0),e.length&&e.attr("id")===o&&u.attr("disabled",!0))},_maximizeZoomDialog:function(){var o=this,t=o.$modal,u=t.find(".modal-header:visible"),f=t.find(".modal-footer:visible"),i=t.find(".modal-body"),r=n(window).height(),e=0;t.addClass("file-zoom-fullscreen");u&&u.length&&(r-=u.outerHeight(!0));f&&f.length&&(r-=f.outerHeight(!0));i&&i.length&&(e=i.outerHeight(!0)-i.height(),r-=e);t.find(".kv-zoom-body").height(r)},_resizeZoomDialog:function(n){var r=this,i=r.$modal,u=i.find(".btn-fullscreen"),f=i.find(".btn-borderless");if(i.hasClass("file-zoom-fullscreen"))t.toggleFullScreen(!1),n?u.hasClass("active")||(i.removeClass("file-zoom-fullscreen"),r._resizeZoomDialog(!0),f.hasClass("active")&&f.removeClass("active").attr("aria-pressed","false")):u.hasClass("active")?u.removeClass("active").attr("aria-pressed","false"):(i.removeClass("file-zoom-fullscreen"),r.$modal.find(".kv-zoom-body").css("height",r.zoomModalHeight));else{if(!n){r._maximizeZoomDialog();return}t.toggleFullScreen(!0)}i.focus()},_setZoomContent:function(i,r){var u=this,h,y,c,l,e,o,a,s=i.attr("id"),p=u._getZoom(s),f=u.$modal,v,k=f.find(".btn-fullscreen"),d=f.find(".btn-borderless"),w,b,g=f.find(".btn-toggleheader");y=p.attr("data-template")||"generic";h=p.find(".kv-file-content");c=h.length?h.html():"";w=i.data("caption")||"";b=i.data("size")||"";l=w+" "+b;f.find(".kv-zoom-title").attr("title",n("<div/>").html(l).text()).html(l);e=f.find(".kv-zoom-body");f.removeClass("kv-single-content");r?(v=e.addClass("file-thumb-loading").clone().insertAfter(e),t.setHtml(e,c).hide(),v.fadeOut("fast",function(){e.fadeIn("fast",function(){e.removeClass("file-thumb-loading")});v.remove()})):t.setHtml(e,c);a=u.previewZoomSettings[y];a&&(o=e.find(".kv-preview-data"),t.addCss(o,"file-zoom-detail"),n.each(a,function(n,t){o.css(n,t);(o.attr("width")&&n==="width"||o.attr("height")&&n==="height")&&o.removeAttr(n)}));f.data("previewId",s);u._handler(f.find(".btn-prev"),"click",function(){u._zoomSlideShow("prev",s)});u._handler(f.find(".btn-next"),"click",function(){u._zoomSlideShow("next",s)});u._handler(k,"click",function(){u._resizeZoomDialog(!0)});u._handler(d,"click",function(){u._resizeZoomDialog(!1)});u._handler(g,"click",function(){var n=f.find(".modal-header"),t=f.find(".modal-body .floating-buttons"),i,r=n.find(".kv-zoom-actions"),e=function(t){var r=u.$modal.find(".kv-zoom-body"),i=u.zoomModalHeight;f.hasClass("file-zoom-fullscreen")&&(i=r.outerHeight(!0),t||(i=i-n.outerHeight(!0)));r.css("height",t?i+t:i)};n.is(":visible")?(i=n.outerHeight(!0),n.slideUp("slow",function(){r.find(".btn").appendTo(t);e(i)})):(t.find(".btn").appendTo(r),n.slideDown("slow",function(){e()}));f.focus()});u._handler(f,"keydown",function(t){var i=t.which||t.keyCode,r=n(this).find(".btn-prev"),f=n(this).find(".btn-next"),e=n(this).data("previewId"),o=u.rtl?39:37,s=u.rtl?37:39;i===o&&r.length&&!r.attr("disabled")&&u._zoomSlideShow("prev",e);i===s&&f.length&&!f.attr("disabled")&&u._zoomSlideShow("next",e)})},_showModal:function(n){var i=this,r=i.$modal;n&&n.length&&(t.initModal(r),t.setHtml(r,i._getModalContent()),i._setZoomContent(n),r.data("fileinputPluginId",i.$element.attr("id")),r.modal("show"),i._initZoomButtons())},_zoomPreview:function(n){var r=this,i;if(!n.length)throw"Cannot zoom to detailed preview!";i=n.closest(t.FRAMES);r._showModal(i)},_zoomSlideShow:function(t,i){var u=this,l=u.$modal.find(".kv-zoom-actions .btn-"+t),h,r,o,c=u.getFrames().toArray(),f=[],s=c.length,e;if(!l.attr("disabled")){for(r=0;r<s;r++)o=n(c[r]),o&&o.length&&o.find(".kv-file-zoom:visible").length&&f.push(c[r]);for(s=f.length,r=0;r<s;r++)if(n(f[r]).attr("id")===i){e=t==="prev"?r-1:r+1;break}e<0||e>=s||!f[e]||(h=n(f[e]),h.length&&u._setZoomContent(h,!0),u._initZoomButtons(),u._raise("filezoom"+t,{previewId:i,modal:u.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var i=n(this);t._handler(i,"click",function(){t._zoomPreview(i)})})},_inputFileCount:function(){return this.$element[0].files.length},_refreshPreview:function(){var t=this,i;(t._inputFileCount()||t.isAjaxUpload)&&t.showPreview&&t.isPreviewable&&(t.isAjaxUpload?t.fileManager.count()>0?(i=n.extend(!0,{},t.fileManager.stack),t.fileManager.clear(),t._clearFileInput()):i=t.$element[0].files:i=t.$element[0].files,i&&i.length&&(t.readFiles(i),t._setFileDropZoneTitle()))},_clearObjects:function(t){t.find("video audio").each(function(){this.pause();n(this).remove()});t.find("img object div").each(function(){n(this).remove()})},_clearFileInput:function(){var f=this,i=f.$element,u,t,r;f._inputFileCount()&&(u=i.closest("form"),t=n(document.createElement("form")),r=n(document.createElement("div")),i.before(r),u.length?u.after(t):r.after(t),t.append(i).trigger("reset"),r.before(i).remove(),t.remove())},_resetUpload:function(){var n=this;n.uploadStartTime=t.now();n.uploadCache=[];n.$btnUpload.removeAttr("disabled");n._setProgress(0);n._hideProgress();n._resetErrors(!1);n._initAjax();n.fileManager.clearImages();n._resetCanvas();n.overwriteInitial&&(n.initialPreview=[],n.initialPreviewConfig=[],n.initialPreviewThumbTags=[],n.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var n=this;n.canvas&&n.imageCanvasContext&&n.imageCanvasContext.clearRect(0,0,n.canvas.width,n.canvas.height)},_hasInitialPreview:function(){var n=this;return!n.overwriteInitial&&n.previewCache.count(!0)},_resetPreview:function(){var i=this,u,f,r,e=i.showUploadedThumbs,o=!i.removeFromPreviewOnError,s=(e||o)&&i.isDuplicateError;i.previewCache.count(!0)?(u=i.previewCache.out(),s&&(r=t.createElement("").insertAfter(i.$container),i.getFrames().each(function(){var t=n(this);(e&&t.hasClass("file-preview-success")||o&&t.hasClass("file-preview-error"))&&r.append(t)})),i._setPreviewContent(u.content),i._setInitThumbAttr(),f=i.initialCaption?i.initialCaption:u.caption,i._setCaption(f),s&&(r.contents().appendTo(i.$preview),r.remove())):(i._clearPreview(),i._initCaption());i.showPreview&&(i._initZoom(),i._initSortable());i.isDuplicateError=!1},_clearDefaultPreview:function(){var n=this;n.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var n=this;n.showPreview&&!t.isEmpty(n.defaultPreviewContent)&&(n._setPreviewContent('<div class="file-default-preview">'+n.defaultPreviewContent+"<\/div>"),n.$container.removeClass("file-input-new"),n._initClickable())},_resetPreviewThumbs:function(n){var t=this,i;if(n){t._clearPreview();t.clearFileStack();return}t._hasInitialPreview()?(i=t.previewCache.out(),t._setPreviewContent(i.content),t._setInitThumbAttr(),t._setCaption(i.caption),t._initPreviewActions()):t._clearPreview()},_getLayoutTemplate:function(n){var i=this,r=i.layoutTemplates[n];return t.isEmpty(i.customLayoutTags)?r:t.replaceTags(r,i.customLayoutTags)},_getPreviewTemplate:function(n){var i=this,r=i.previewTemplates,u=r[n]||r.other;return t.isEmpty(i.customPreviewTags)?u:t.replaceTags(u,i.customPreviewTags)},_getOutData:function(n,t,i,r){var u=this;return t=t||{},i=i||{},r=r||u.fileManager.list(),{formdata:n,files:r,filenames:u.filenames,filescount:u.getFilesCount(),extra:u._getExtraData(),response:i,reader:u.reader,jqXHR:t}},_getMsgSelected:function(n){var t=this,i=n===1?t.fileSingle:t.filePlural;return n>0?t.msgSelected.replace("{n}",n).replace("{files}",i):t.msgNoFilesSelected},_getFrame:function(n,i){var r=this,u=t.getFrameElement(r.$preview,n);return!r.showPreview||i||u.length||r._log(t.logMessages.invalidThumb,{id:n}),u},_getZoom:function(n,i){var r=this,u=t.getZoomElement(r.$preview,n,i);return r.showPreview&&!u.length&&r._log(t.logMessages.invalidThumb,{id:n}),u},_getThumbs:function(n){return n=n||"",this.getFrames(":not(.file-preview-initial)"+n)},_getThumbId:function(n){var t=this;return t.previewInitId+"-"+n},_getExtraData:function(n,t){var i=this,r=i.uploadExtraData;return typeof i.uploadExtraData=="function"&&(r=i.uploadExtraData(n,t)),r},_initXhr:function(n,i){var r=this,f=r.fileManager,u=function(n){var u=0,o=n.total,s=n.loaded||n.position,e=f.getUploadStats(i,s,o);n.lengthComputable&&!r.enableResumableUpload&&(u=t.round(s/o*100));i?r._setFileUploadStats(i,u,e):r._setProgress(u,null,null,r._getStats(e));r._raise("fileajaxprogress",[e])};return n.upload&&(r.progressDelay&&(u=t.debounce(u,r.progressDelay)),n.upload.addEventListener("progress",u,!1)),n},_initAjaxSettings:function(){var t=this;t._ajaxSettings=n.extend(!0,{},t.ajaxSettings);t._ajaxDeleteSettings=n.extend(!0,{},t.ajaxDeleteSettings)},_mergeAjaxCallback:function(n,t,i){var r=this,f=r._ajaxSettings,e=r.mergeAjaxCallbacks,u;i==="delete"&&(f=r._ajaxDeleteSettings,e=r.mergeAjaxDeleteCallbacks);u=f[n];f[n]=e&&typeof u=="function"?e==="before"?function(){u.apply(this,arguments);t.apply(this,arguments)}:function(){t.apply(this,arguments);u.apply(this,arguments)}:t},_ajaxSubmit:function(t,i,r,u,f,e,o,s){var h=this,l,a,c,v;h._raise("filepreajax",[f,e,o])&&(f.append("initialPreview",JSON.stringify(h.initialPreview)),f.append("initialPreviewConfig",JSON.stringify(h.initialPreviewConfig)),f.append("initialPreviewThumbTags",JSON.stringify(h.initialPreviewThumbTags)),h._initAjaxSettings(),h._mergeAjaxCallback("beforeSend",t),h._mergeAjaxCallback("success",i),h._mergeAjaxCallback("complete",r),h._mergeAjaxCallback("error",u),s=s||h.uploadUrlThumb||h.uploadUrl,typeof s=="function"&&(s=s()),c=h._getExtraData(e,o)||{},typeof c=="object"&&n.each(c,function(n,t){f.append(n,t)}),a={xhr:function(){var t=n.ajaxSettings.xhr();return h._initXhr(t,e)},url:h._encodeURI(s),type:"POST",dataType:"json",data:f,cache:!1,processData:!1,contentType:!1},l=n.extend(!0,{},a,h._ajaxSettings),v=h.taskManager.addTask(e+"-"+o,function(){var t=this.self,i,r;i=t.ajaxQueue.shift();r=n.ajax(i);t.ajaxRequests.push(r)}),h.ajaxQueue.push(l),v.runWithContext({self:h}))},_mergeArray:function(n,i){var r=this,u=t.cleanArray(r[n]),f=t.cleanArray(i);r[n]=u.concat(f)},_initUploadSuccess:function(i,r,u){var f=this,h,y,p,c,l,e,o,s,a,v;if(!f.showPreview||typeof i!="object"||n.isEmptyObject(i)){f._resetCaption();return}i.initialPreview!==undefined&&i.initialPreview.length>0&&(f.hasInitData=!0,e=i.initialPreview||[],o=i.initialPreviewConfig||[],s=i.initialPreviewThumbTags||[],h=i.append===undefined||i.append,e.length>0&&!t.isArray(e)&&(e=e.split(f.initialPreviewDelimiter)),e.length&&(f._mergeArray("initialPreview",e),f._mergeArray("initialPreviewConfig",o),f._mergeArray("initialPreviewThumbTags",s)),r!==undefined?u?(a=r.attr("id"),v=f._getUploadCacheIndex(a),v!==null&&(f.uploadCache[v]={id:a,content:e[0],config:o[0]||[],tags:s[0]||[],append:h})):(p=f.previewCache.add(e[0],o[0],s[0],h),y=f.previewCache.get(p,!1),c=t.createElement(y).hide().appendTo(r),l=c.find(".kv-zoom-cache"),l&&l.length&&l.appendTo(r),r.fadeOut("slow",function(){var n=c.find(".file-preview-frame");n&&n.length&&n.insertBefore(r).fadeIn("slow").css("display:inline-block");f._initPreviewActions();f._clearFileInput();r.remove();c.remove();f._initSortable()})):(f.previewCache.set(e,o,s,h),f._initPreview(),f._initPreviewActions()));f._resetCaption()},_getUploadCacheIndex:function(n){for(var i=this,u=i.uploadCache.length,r,t=0;t<u;t++)if(r=i.uploadCache[t],r.id===n)return t;return null},_initSuccessThumbs:function(){var i=this;i.showPreview&&i._getThumbs(t.FRAMES+".file-preview-success").each(function(){var r=n(this),u=r.find(".kv-file-remove");u.removeAttr("disabled");i._handler(u,"click",function(){var n=r.attr("id"),u=i._raise("filesuccessremove",[n,r.attr("data-fileindex")]);(t.cleanMemory(r),u!==!1)&&r.fadeOut("slow",function(){r.remove();i.getFrames().length||i.reset()})})})},_updateInitialPreview:function(){var t=this,i=t.uploadCache;t.showPreview&&(n.each(i,function(n,i){t.previewCache.add(i.content,i.config,i.tags,i.append)}),t.hasInitData&&(t._initPreview(),t._initPreviewActions()))},_uploadSingle:function(i,r,u){var f=this,o=f.fileManager,g=o.count(),c=new FormData,l,p=f._getThumbId(r),e,w,s,a,ut=g>0||!n.isEmptyObject(f.uploadExtraData),b,k,nt,v,tt,it,rt,y,d=f.ajaxOperations.uploadThumb,ft=o.getFile(r),h={id:p,index:i,fileId:r},et=f.fileManager.getFileName(r,!0);f.enableResumableUpload||(f.showPreview&&(e=f.fileManager.getThumb(r),k=e.find(".file-thumb-progress"),s=e.find(".kv-file-upload"),a=e.find(".kv-file-remove"),k.show()),g===0||!ut||f.showPreview&&s&&s.hasClass("disabled")||f._abort(h))||(y=function(){b?o.errors.push(r):o.removeFile(r);o.setProcessed(r);o.isProcessed()&&(f.fileBatchCompleted=!0,w())},w=function(){var n;f.fileBatchCompleted&&setTimeout(function(){var i=o.count()===0,r=o.errors.length;f._updateInitialPreview();f.unlock(i);i&&f._clearFileInput();n=f.$preview.find(".file-preview-initial");f.uploadAsync&&n.length&&(t.addCss(n,t.SORT_CSS),f._initSortable());f._raise("filebatchuploadcomplete",[o.stack,f._getExtraData()]);f.retryErrorUploads&&r!==0||o.clear();f._setProgress(101);f.ajaxAborted=!1},f.processDelay)},nt=function(v){l=f._getOutData(c,v);o.initStats(r);f.fileBatchCompleted=!1;u||(f.ajaxAborted=!1);f.showPreview&&(e.hasClass("file-preview-success")||(f._setThumbStatus(e,"Loading"),t.addCss(e,"file-uploading")),s.attr("disabled",!0),a.attr("disabled",!0));u||f.lock();o.errors.indexOf(r)!==-1&&delete o.errors[r];f._raise("filepreupload",[l,p,i]);n.extend(!0,h,l);f._abort(h)&&(v.abort(),u||(f._setThumbStatus(e,"New"),e.removeClass("file-uploading"),s.removeAttr("disabled"),a.removeAttr("disabled"),f.unlock()),f._setProgressCancelled())},tt=function(o,a,w){var g=f.showPreview&&e.attr("id")?e.attr("id"):p;l=f._getOutData(c,w,o);n.extend(!0,h,l);setTimeout(function(){t.isEmpty(o)||t.isEmpty(o.error)?(f.showPreview&&(f._setThumbStatus(e,"Success"),s.hide(),f._initUploadSuccess(o,e,u),f._setProgress(101,k)),f._raise("fileuploaded",[l,g,i]),u?y():f.fileManager.remove(e)):(b=!0,v=f._parseError(d,w,f.msgUploadError,f.fileManager.getFileName(r)),f._showFileError(v,h),f._setPreviewError(e,!0),f.retryErrorUploads||s.hide(),u&&y(),f._setProgress(101,f._getFrame(g).find(".file-thumb-progress"),f.msgUploadError))},f.processDelay)},it=function(){f.showPreview&&(s.removeAttr("disabled"),a.removeAttr("disabled"),e.removeClass("file-uploading"));u?w():(f.unlock(!1),f._clearFileInput());f._initSuccessThumbs()},rt=function(t,i,o){v=f._parseError(d,t,o,f.fileManager.getFileName(r));b=!0;setTimeout(function(){var i;u&&y();f.fileManager.setProgress(r,100);f._setPreviewError(e,!0);f.retryErrorUploads||s.hide();n.extend(!0,h,f._getOutData(c,t));f._setProgress(101,f.$progress,f.msgAjaxProgressError.replace("{operation}",d));i=f.showPreview&&e?e.find(".file-thumb-progress"):"";f._setProgress(101,i,f.msgUploadError);f._showFileError(v,h)},f.processDelay)},c.append(f.uploadFileAttr,ft.file,et),f._setUploadData(c,{fileId:r}),f._ajaxSubmit(nt,tt,it,rt,c,r,i))},_uploadBatch:function(){var i=this,s=i.fileManager,f=s.total(),h,c,l,a,y=f>0||!n.isEmptyObject(i.uploadExtraData),u,v,r=new FormData,e=i.ajaxOperations.uploadBatch,o;f!==0&&y&&!i._abort({})&&(v=function(){i.fileManager.clear();i._clearFileInput()},h=function(u){i.lock();s.initStats();var f=i._getOutData(r,u);i.ajaxAborted=!1;i.showPreview&&i._getThumbs().each(function(){var r=n(this),u=r.find(".kv-file-upload"),f=r.find(".kv-file-remove");r.hasClass("file-preview-success")||(i._setThumbStatus(r,"Loading"),t.addCss(r,"file-uploading"));u.attr("disabled",!0);f.attr("disabled",!0)});i._raise("filebatchpreupload",[f]);i._abort(f)&&(u.abort(),i._getThumbs().each(function(){var t=n(this),r=t.find(".kv-file-upload"),u=t.find(".kv-file-remove");t.hasClass("file-preview-loading")&&(i._setThumbStatus(t,"New"),t.removeClass("file-uploading"));r.removeAttr("disabled");u.removeAttr("disabled")}),i._setProgressCancelled())},c=function(f,o,s){var h=i._getOutData(r,s,f),c=0,l=i._getThumbs(":not(.file-preview-success)"),a=t.isEmpty(f)||t.isEmpty(f.errorkeys)?[]:f.errorkeys;t.isEmpty(f)||t.isEmpty(f.error)?(i._raise("filebatchuploadsuccess",[h]),v(),i.showPreview?(l.each(function(){var t=n(this);i._setThumbStatus(t,"Success");t.removeClass("file-uploading");t.find(".kv-file-upload").hide().removeAttr("disabled")}),i._initUploadSuccess(f)):i.reset(),i._setProgress(101)):(i.showPreview&&(l.each(function(){var t=n(this);t.removeClass("file-uploading");t.find(".kv-file-upload").removeAttr("disabled");t.find(".kv-file-remove").removeAttr("disabled");a.length===0||n.inArray(c,a)!==-1?(i._setPreviewError(t,!0),i.retryErrorUploads||(t.find(".kv-file-upload").hide(),i.fileManager.remove(t))):(t.find(".kv-file-upload").hide(),i._setThumbStatus(t,"Success"),i.fileManager.remove(t));(!t.hasClass("file-preview-error")||i.retryErrorUploads)&&c++}),i._initUploadSuccess(f)),u=i._parseError(e,s,i.msgUploadError),i._showFileError(u,h,"filebatchuploaderror"),i._setProgress(101,i.$progress,i.msgUploadError))},a=function(){i.unlock();i._initSuccessThumbs();i._clearFileInput();i._raise("filebatchuploadcomplete",[i.fileManager.stack,i._getExtraData()])},l=function(t,o,s){var h=i._getOutData(r,t);(u=i._parseError(e,t,s),i._showFileError(u,h,"filebatchuploaderror"),i.uploadFileCount=f-1,i.showPreview)&&(i._getThumbs().each(function(){var t=n(this);t.removeClass("file-uploading");i.fileManager.getFile(t.attr("data-fileid"))&&i._setPreviewError(t)}),i._getThumbs().removeClass("file-uploading"),i._getThumbs(" .kv-file-upload").removeAttr("disabled"),i._getThumbs(" .kv-file-delete").removeAttr("disabled"),i._setProgress(101,i.$progress,i.msgAjaxProgressError.replace("{operation}",e)))},o=0,n.each(i.fileManager.stack,function(n,u){t.isEmpty(u.file)||r.append(i.uploadFileAttr,u.file,u.nameFmt||"untitled_"+o);o++}),i._ajaxSubmit(h,c,a,l,r))},_uploadExtraOnly:function(){var n=this,i={},e,o,s,h,r=new FormData,u,f=n.ajaxOperations.uploadExtra;n._abort(i)||(e=function(t){n.lock();var u=n._getOutData(r,t);n._raise("filebatchpreupload",[u]);n._setProgress(50);i.data=u;i.xhr=t;n._abort(i)&&(t.abort(),n._setProgressCancelled())},o=function(i,e,o){var s=n._getOutData(r,o,i);t.isEmpty(i)||t.isEmpty(i.error)?(n._raise("filebatchuploadsuccess",[s]),n._clearFileInput(),n._initUploadSuccess(i),n._setProgress(101)):(u=n._parseError(f,o,n.msgUploadError),n._showFileError(u,s,"filebatchuploaderror"))},s=function(){n.unlock();n._clearFileInput();n._raise("filebatchuploadcomplete",[n.fileManager.stack,n._getExtraData()])},h=function(t,e,o){var s=n._getOutData(r,t);u=n._parseError(f,t,o);i.data=s;n._showFileError(u,s,"filebatchuploaderror");n._setProgress(101,n.$progress,n.msgAjaxProgressError.replace("{operation}",f))},n._ajaxSubmit(e,o,s,h,r))},_deleteFileIndex:function(i){var r=this,u=i.attr("data-fileindex"),f=r.reversePreviewOrder;u.substring(0,5)===t.INIT_FLAG&&(u=parseInt(u.replace(t.INIT_FLAG,"")),r.initialPreview=t.spliceArray(r.initialPreview,u,f),r.initialPreviewConfig=t.spliceArray(r.initialPreviewConfig,u,f),r.initialPreviewThumbTags=t.spliceArray(r.initialPreviewThumbTags,u,f),r.getFrames().each(function(){var r=n(this),i=r.attr("data-fileindex");i.substring(0,5)===t.INIT_FLAG&&(i=parseInt(i.replace(t.INIT_FLAG,"")),i>u&&(i--,r.attr("data-fileindex",t.INIT_FLAG+i)))}))},_resetCaption:function(){var n=this;setTimeout(function(){var t,i,u=n.previewCache.count(!0),f=n.fileManager.count(),r,e=n.showPreview&&n.getFrames(":not(.file-preview-success):not(.file-preview-error)").length;f!==0||u!==0||e?(i=u+f,i>1?t=n._getMsgSelected(i):(r=n.fileManager.getFirstFile(),t=r?r.nameFmt:"_"),n._setCaption(t)):n.reset()},n.processDelay)},_initFileActions:function(){var i=this;i.showPreview&&(i._initZoomButton(),i.getFrames(" .kv-file-remove").each(function(){var f=n(this),r=f.closest(t.FRAMES),e,u=r.attr("id"),o=r.attr("data-fileindex"),s;i._handler(f,"click",function(){if(s=i._raise("filepreremove",[u,o]),s===!1||!i._validateMinCount())return!1;e=r.hasClass("file-preview-error");t.cleanMemory(r);r.fadeOut("slow",function(){i.fileManager.remove(r);i._clearObjects(r);r.remove();u&&e&&i.$errorContainer.find('li[data-thumb-id="'+u+'"]').fadeOut("fast",function(){n(this).remove();i._errorsExist()||i._resetErrors()});i._clearFileInput();i._resetCaption();i._raise("fileremoved",[u,o])})})}),i.getFrames(" .kv-file-upload").each(function(){var r=n(this);i._handler(r,"click",function(){var n=r.closest(t.FRAMES),u=n.attr("data-fileid");(i._hideProgress(),!n.hasClass("file-preview-error")||i.retryErrorUploads)&&i._uploadSingle(i.fileManager.getIndex(u),u,!1)})}))},_initPreviewActions:function(){var i=this,o=i.$preview,s=i.deleteExtraData||{},h=t.FRAMES+" .kv-file-remove",e=i.fileActionSettings,r=e.removeClass,u=e.removeErrorClass,f=function(){var n=i.isAjaxUpload?i.previewCache.count(!0):i._inputFileCount();i.getFrames().length||n||(i._setCaption(""),i.reset(),i.initialCaption="")};i._initZoomButton();o.find(h).each(function(){var o=n(this),y=o.data("url")||i.deleteUrl,a=o.data("key"),k,d,g,nt,tt=i.ajaxOperations.deleteThumb;if(!t.isEmpty(y)&&a!==undefined){typeof y=="function"&&(y=y());var e=o.closest(t.FRAMES),p=i.previewCache.data,w,c,l,b,h,v=e.attr("data-fileindex");v=parseInt(v.replace(t.INIT_FLAG,""));l=t.isEmpty(p.config)&&t.isEmpty(p.config[v])?null:p.config[v];h=t.isEmpty(l)||t.isEmpty(l.extra)?s:l.extra;b=l&&(l.filename||l.caption)||"";typeof h=="function"&&(h=h());c={id:o.attr("id"),key:a,extra:h};d=function(n){i.ajaxAborted=!1;i._raise("filepredelete",[a,n,h]);i._abort()?n.abort():(o.removeClass(u),t.addCss(e,"file-uploading"),t.addCss(o,"disabled "+r))};g=function(n,s,l){var y,p;if(!t.isEmpty(n)&&!t.isEmpty(n.error)){c.jqXHR=l;c.response=n;k=i._parseError(tt,l,i.msgDeleteError,b);i._showFileError(k,c,"filedeleteerror");e.removeClass("file-uploading");o.removeClass("disabled "+r).addClass(u);f();return}e.removeClass("file-uploading").addClass("file-deleted");e.fadeOut("slow",function(){v=parseInt(e.attr("data-fileindex").replace(t.INIT_FLAG,""));i.previewCache.unset(v);i._deleteFileIndex(e);y=i.previewCache.count(!0);p=y>0?i._getMsgSelected(y):"";i._setCaption(p);i._raise("filedeleted",[a,l,h]);i._clearObjects(e);e.remove();f()})};nt=function(n,t,s){var h=i._parseError(tt,n,s,b);c.jqXHR=n;c.response={};i._showFileError(h,c,"filedeleteerror");e.removeClass("file-uploading");o.removeClass("disabled "+r).addClass(u);f()};i._initAjaxSettings();i._mergeAjaxCallback("beforeSend",d,"delete");i._mergeAjaxCallback("success",g,"delete");i._mergeAjaxCallback("error",nt,"delete");w=n.extend(!0,{},{url:i._encodeURI(y),type:"POST",dataType:"json",data:n.extend(!0,{},{key:a},h)},i._ajaxDeleteSettings);i._handler(o,"click",function(){if(!i._validateMinCount())return!1;i.ajaxAborted=!1;i._raise("filebeforedelete",[a,h]);i.ajaxAborted instanceof Promise?i.ajaxAborted.then(function(t){t||n.ajax(w)}):i.ajaxAborted||n.ajax(w)})}})},_hideFileIcon:function(){var n=this;n.overwriteInitial&&n.$captionContainer.removeClass("icon-visible")},_showFileIcon:function(){var n=this;t.addCss(n.$captionContainer,"icon-visible")},_getSize:function(t,i){var e=this,r=parseFloat(t),f,o=e.fileSizeGetter,u;return!n.isNumeric(t)||!n.isNumeric(r)?"":(typeof o=="function"?u=o(r):r===0?u="0.00 B":(f=Math.floor(Math.log(r)/Math.log(1024)),i||(i=["B","KB","MB","GB","TB","PB","EB","ZB","YB"]),u=(r/Math.pow(1024,f)).toFixed(2)*1+" "+i[f]),e._getLayoutTemplate("size").replace("{sizeText}",u))},_getFileType:function(n){var t=this;return t.mimeTypeAliases[n]||n},_generatePreviewTemplate:function(i,r,u,f,e,o,s,h,c,l,a,v,y,p){var w=this,k=w.slug(u),rt,b="",g="",et=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,nt,tt=k,ot=k,ut="type-default",it,st=l||w._renderFileFooter(i,k,h,"auto",s),ft=w.preferIconicPreview,ht=w.preferIconicZoomPreview,d=ft?"other":i;return nt=et<400?w.previewSettingsSmall[d]||w.defaults.previewSettingsSmall[d]:w.previewSettings[d]||w.defaults.previewSettings[d],nt&&n.each(nt,function(n,t){g+=n+":"+t+";"}),it=function(r,s,h,l){var d=h?"zoom-"+e:e,b=w._getPreviewTemplate(r),p=(c||"")+" "+l;return w.frameClass&&(p=w.frameClass+" "+p),h&&(p=p.replace(" "+t.SORT_CSS,"")),b=w._parseFilePreviewIcon(b,u),r==="text"&&(s=t.htmlEncode(s)),i!=="object"||f||n.each(w.defaults.fileTypeSettings,function(n,t){n!=="object"&&n!=="other"&&t(u,f)&&(ut="type-"+n)}),t.isEmpty(y)||(y.title!==undefined&&y.title!==null&&(tt=y.title),y.alt!==undefined&&y.alt!==null&&(tt=y.alt)),b.setTokens({previewId:d,caption:k,title:tt,alt:ot,frameClass:p,type:w._getFileType(f),fileindex:a,fileid:o||"",typeCss:ut,footer:st,data:s,template:v||i,style:g?'style="'+g+'"':""})},a=a||e.slice(e.lastIndexOf("-")+1),w.fileActionSettings.showZoom&&(b=it(ht?"other":i,p?p:r,!0,"kv-zoom-thumb")),b="\n"+w._getLayoutTemplate("zoomCache").replace("{zoomContent}",b),typeof w.sanitizeZoomCache=="function"&&(b=w.sanitizeZoomCache(b)),rt=it(ft?"other":i,r,!1,"kv-preview-thumb"),rt.setTokens({zoomCache:b})},_addToPreview:function(n,i){var u=this,r;return i=t.cspBuffer.stash(i),r=u.reversePreviewOrder?n.prepend(i):n.append(i),t.cspBuffer.apply(n),r},_previewDefault:function(n,i){var r=this,s=r.$preview;if(r.showPreview){var h=t.getFileName(n),c=n?n.type:"",f,e=n.size||0,l=r._getFileName(n,""),a=i===!0&&!r.isAjaxUpload,v=t.createObjectURL(n),o=r.fileManager.getId(n),u=r._getThumbId(o);r._clearDefaultPreview();f=r._generatePreviewTemplate("other",v,h,c,u,o,a,e);r._addToPreview(s,f);r._setThumbAttr(u,l,e);i===!0&&r.isAjaxUpload&&r._setThumbStatus(r._getFrame(u),"Error")}},_previewFile:function(n,i,r,u,f){var w;if(this.showPreview){var e=this,v=t.getFileName(i),c=f.type,y=f.name,o=e._parseFileType(c,v),p,b=e.$preview,l=i.size||0,s=o==="text"||o==="html"||o==="image"?r.target.result:u,a=e.fileManager.getId(i),h=e._getThumbId(a);o==="html"&&e.purifyHtml&&window.DOMPurify&&(s=window.DOMPurify.sanitize(s));p=e._generatePreviewTemplate(o,s,v,c,h,a,!1,l);e._clearDefaultPreview();e._addToPreview(b,p);w=e._getFrame(h);e._validateImageOrientation(w.find("img"),i,h,a,y,c,l,s);e._setThumbAttr(h,y,l);e._initSortable()}},_setThumbAttr:function(n,t,i){var r=this,u=r._getFrame(n);u.length&&(i=i&&i>0?r._getSize(i):"",u.data({caption:t,size:i}))},_setInitThumbAttr:function(){var i=this,s=i.previewCache.data,u=i.previewCache.count(!0),r,f,e,o,n;if(u!==0)for(n=0;n<u;n++)r=s.config[n],o=i.previewInitId+"-"+t.INIT_FLAG+n,f=t.ifSet("caption",r,t.ifSet("filename",r)),e=t.ifSet("size",r),i._setThumbAttr(o,f,e)},_slugDefault:function(n){return t.isEmpty(n,!0)?"":String(n).replace(/[\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_updateFileDetails:function(n,i){var r=this,f=r.$element,u,e,s,h,c,o=t.isIE(9)&&t.findFileName(f.val())||f[0].files[0]&&f[0].files[0].name;!o&&r.fileManager.count()>0?(c=r.fileManager.getFirstFile(),u=c.nameFmt):u=o?r.slug(o):"_";e=r.isAjaxUpload?r.fileManager.count():n;h=r.previewCache.count(!0)+e;s=e===1?u:r._getMsgSelected(h);r.isError?(r.$previewContainer.removeClass("file-thumb-loading"),r.$previewStatus.html(""),r.$captionContainer.removeClass("icon-visible")):r._showFileIcon();r._setCaption(s,r.isError);r.$container.removeClass("file-input-new file-input-ajax-new");i||r._raise("fileselect",[n,u]);r.previewCache.count(!0)&&r._initPreviewActions()},_setThumbStatus:function(n,i){var r=this;if(r.showPreview){var u="indicator"+i,o=u+"Title",s="file-preview-"+i.toLowerCase(),f=n.find(".file-upload-indicator"),e=r.fileActionSettings;n.removeClass("file-preview-success file-preview-error file-preview-paused file-preview-loading");i==="Success"&&n.find(".file-drag-handle").remove();t.setHtml(f,e[u]);f.attr("title",e[o]);n.addClass(s);i!=="Error"||r.retryErrorUploads||n.find(".kv-file-upload").attr("disabled",!0)}},_setProgressCancelled:function(){var n=this;n._setProgress(101,n.$progress,n.msgCancelled)},_setProgress:function(n,i,r,u){var f=this;if(i=i||f.$progress,i.length){var e=Math.min(n,100),o,s=f.progressUploadThreshold,c=n<=100?f.progressTemplate:f.progressCompleteTemplate,h=e<100?f.progressTemplate:r?f.paused?f.progressPauseTemplate:f.progressErrorTemplate:c;n>=100&&(u="");t.isEmpty(h)||(o=s&&e>s&&n<=100?h.setTokens({percent:s,status:f.msgUploadThreshold}):h.setTokens({percent:e,status:n>100?f.msgUploadEnd:e+"%"}),u=u||"",o=o.setTokens({stats:u}),t.setHtml(i,o),r&&t.setHtml(i.find('[role="progressbar"]'),r))}},_hasFiles:function(){var n=this.$element[0];return!!(n&&n.files&&n.files.length)},_setFileDropZoneTitle:function(){var n=this,i=n.$container.find(".file-drop-zone"),r=n.dropZoneTitle,u;(n.isClickable&&(u=t.isEmpty(n.$element.attr("multiple"))?n.fileSingle:n.filePlural,r+=n.dropZoneClickTitle.replace("{files}",u)),i.find("."+n.dropZoneTitleClass).remove(),!n.showPreview||i.length===0||n.fileManager.count()>0||!n.dropZoneEnabled||n.previewCache.count()>0||!n.isAjaxUpload&&n._hasFiles())||(i.find(t.FRAMES).length===0&&t.isEmpty(n.defaultPreviewContent)&&i.prepend('<div class="'+n.dropZoneTitleClass+'">'+r+"<\/div>"),n.$container.removeClass("file-input-new"),t.addCss(n.$container,"file-input-ajax-new"))},_getStats:function(n){var i=this,r,u;return!i.showUploadStats||!n||!n.bitrate?"":(u=i._getLayoutTemplate("stats"),r=!n.elapsed||!n.bps?i.msgCalculatingTime:i.msgPendingTime.setTokens({time:t.getElapsed(Math.ceil(n.pendingBytes/n.bps))}),u.setTokens({uploadSpeed:n.bitrate,pendingTime:r}))},_setResumableProgress:function(n,t,i){var u=this,f=u.resumableManager,r=i?f:u,e=i?i.find(".file-thumb-progress"):null;r.lastProgress===0&&(r.lastProgress=n);n<r.lastProgress&&(n=r.lastProgress);u._setProgress(n,e,null,u._getStats(t));r.lastProgress=n},_toggleResumableProgress:function(n,i){var u=this,r=u.$progress;r&&r.length&&t.setHtml(r,n.setTokens({percent:101,status:i,stats:""}))},_setFileUploadStats:function(i,r,u){var f=this,o=f.$progress;if(f.showPreview||o&&o.length){var e=f.fileManager,p=f.resumableManager,s=e.getThumb(i),h,a=0,c=e.getTotalSize(),l=n.extend(!0,{},u);if(f.enableResumableUpload){var v=u.loaded,w=p.getUploadedSize(),b=p.file.size,y;v+=w;y=e.uploadedSize+v;r=t.round(100*v/b);u.pendingBytes=b-w;f._setResumableProgress(r,u,s);h=Math.floor(100*y/c);l.pendingBytes=c-y;f._setResumableProgress(h,l)}else e.setProgress(i,r),o=s&&s.length?s.find(".file-thumb-progress"):null,f._setProgress(r,o,null,f._getStats(u)),n.each(e.stats,function(n,t){a+=t.loaded}),l.pendingBytes=c-a,h=t.round(a/c*100),f._setProgress(h,null,null,f._getStats(l))}},_validateMinCount:function(){var n=this,t=n.isAjaxUpload?n.fileManager.count():n._inputFileCount();return n.validateInitialCount&&n.minFileCount>0&&n._getFileCount(t-1)<n.minFileCount?(n._noFilesError({}),!1):!0},_getFileCount:function(n,t){var i=this,r=0;return t===undefined&&(t=i.validateInitialCount&&!i.overwriteInitial),t&&(r=i.previewCache.count(!0),n+=r),n},_getFileId:function(n){return t.getFileId(n,this.generateFileId)},_getFileName:function(n,i){var u=this,r=t.getFileName(n);return r?u.slug(r):i},_getFileNames:function(n){var t=this;return t.filenames.filter(function(t){return n?t!==undefined:t!==undefined&&t!==null})},_setPreviewError:function(n,t){var i=this,r=i.removeFromPreviewOnError&&!i.retryErrorUploads;if((!t||r)&&i.fileManager.remove(n),i.showPreview){if(r){n.remove();return}i._setThumbStatus(n,"Error");i._refreshUploadButton(n)}},_refreshUploadButton:function(n){var u=this,r=n.find(".kv-file-upload"),i=u.fileActionSettings,f=i.uploadIcon,e=i.uploadTitle;r.length&&(u.retryErrorUploads&&(f=i.uploadRetryIcon,e=i.uploadRetryTitle),r.attr("title",e),t.setHtml(r,f))},_checkDimensions:function(n,i,r,u,f,e,o){var h=this,a,l,y=i==="Small"?"min":"max",c=h[y+"Image"+e],s,v;!t.isEmpty(c)&&r.length&&((s=r[0],l=e==="Width"?s.naturalWidth||s.width:s.naturalHeight||s.height,v=i==="Small"?l>=c:l<=c,v)||(a=h["msgImage"+e+i].setTokens({name:f,size:c}),h._showFileError(a,o),h._setPreviewError(u)))},_getExifObj:function(n){var f=this,i,r=t.logMessages.exifWarning;if(n.slice(0,23)!=="data:image/jpeg;base64,"&&n.slice(0,22)!=="data:image/jpg;base64,"){i=null;return}try{i=window.piexif?window.piexif.load(n):null}catch(u){i=null;r=u&&u.message||""}return i||f._log(t.logMessages.badExifParser,{details:r}),i},setImageOrientation:function(i,r,u,f){var e=this,l=!i||!i.length,v=!r||!r.length,o,s=!1,h,a=l&&f&&f.attr("data-template")==="image",c;if(!l||!v){c="load.fileinputimageorient";a?(i=r,r=null,i.css(e.previewSettings.image),h=n(document.createElement("div")).appendTo(f.find(".kv-file-content")),o=n(document.createElement("span")).insertBefore(i),i.css("visibility","hidden").removeClass("file-zoom-detail").appendTo(h)):s=!i.is(":visible");i.off(c).on(c,function(){s&&(e.$preview.removeClass("hide-content"),f.find(".kv-file-content").css("visibility","hidden"));var n=i[0],l=r&&r.length?r[0]:null,v=n.offsetHeight,y=n.offsetWidth,c=t.getRotation(u);if(s&&(f.find(".kv-file-content").css("visibility","visible"),e.$preview.addClass("hide-content")),i.data("orientation",u),l&&r.data("orientation",u),u<5){t.setTransform(n,c);t.setTransform(l,c);return}var b=Math.atan(y/v),p=Math.sqrt(Math.pow(v,2)+Math.pow(y,2)),k=p?v/Math.cos(Math.PI/2+b)/p:1,w=" scale("+Math.abs(k)+")";t.setTransform(n,c+w);t.setTransform(l,c+w);a&&(i.css("visibility","visible").insertAfter(o).addClass("file-zoom-detail"),o.remove(),h.remove())})}},_validateImageOrientation:function(i,r,u,f,e,o,s,h){var c=this,l,a,v=c.autoOrientImage,y;if(c.canOrientImage){i.css("image-orientation",v?"from-image":"none");return}if(y=t.getZoomSelector(u," img"),l=v?c._getExifObj(h):null,a=l?l["0th"][piexif.ImageIFD.Orientation]:null,!a){c._validateImage(u,f,e,o,s,h,l);return}c.setImageOrientation(i,n(y),a,c._getFrame(u));c._raise("fileimageoriented",{$img:i,file:r});c._validateImage(u,f,e,o,s,h,l)},_validateImage:function(t,i,r,u,f,e,o){var s=this,p=s.$preview,a,v,y,h=s._getFrame(t),l=h.attr("data-fileindex"),c=h.find("img");r=r||"Untitled";c.one("load",function(){v=h.width();y=p.width();v>y&&c.css("width","100%");a={ind:l,id:t,fileId:i};s._checkDimensions(l,"Small",c,h,r,"Width",a);s._checkDimensions(l,"Small",c,h,r,"Height",a);s.resizeImage||(s._checkDimensions(l,"Large",c,h,r,"Width",a),s._checkDimensions(l,"Large",c,h,r,"Height",a));s._raise("fileimageloaded",[t]);s.fileManager.addImage(i,{ind:l,img:c,thumb:h,pid:t,typ:u,siz:f,validated:!1,imgData:e,exifObj:o});h.data("exif",o);s._validateAllImages()}).one("error",function(){s._raise("fileimageloaderror",[t])}).each(function(){this.complete?n(this).trigger("load"):this.error&&n(this).trigger("error")})},_validateAllImages:function(){var t=this,u={val:0},r=t.fileManager.getImageCount(),i,f=t.resizeIfSizeMoreThan;r===t.fileManager.totalImages&&(t._raise("fileimagesloaded"),t.resizeImage)&&n.each(t.fileManager.loadedImages,function(n,e){e.validated||(i=e.siz,i&&i>f*1e3&&t._getResizedImage(n,e,u,r),e.validated=!0)})},_getResizedImage:function(i,r,u,f){var e=this,y=n(r.img)[0],o=y.naturalWidth,s=y.naturalHeight,p,w=1,h=e.maxImageWidth||o,c=e.maxImageHeight||s,b=!!(o&&s),k,d,g=e.imageCanvas,l,st=e.imageCanvasContext,nt=r.typ,rt=r.pid,ut=r.ind,ht=r.thumb,a,ft,et=r.exifObj,ot,tt,v,it;if(a=function(n,t,i){e.isAjaxUpload?e._showFileError(n,t,i):e._showError(n,t,i);e._setPreviewError(ht)},tt=e.fileManager.getFile(i),v={id:rt,index:ut,fileId:i},it=[i,rt,ut],(!tt||!b||o<=h&&s<=c)&&(b&&tt&&e._raise("fileimageresized",it),u.val++,u.val===f&&e._raise("fileimagesresized"),!b)){a(e.msgImageResizeError,v,"fileimageresizeerror");return}nt=nt||e.resizeDefaultImageType;k=o>h;d=s>c;w=e.resizePreference==="width"?k?h/o:d?c/s:1:d?c/s:k?h/o:1;e._resetCanvas();o*=w;s*=w;g.width=o;g.height=s;try{st.drawImage(y,0,0,o,s);l=g.toDataURL(nt,e.resizeQuality);et&&(ot=window.piexif.dump(et),l=window.piexif.insert(ot,l));p=t.dataURI2Blob(l);e.fileManager.setFile(i,p);e._raise("fileimageresized",it);u.val++;u.val===f&&e._raise("fileimagesresized",[undefined,undefined]);p instanceof Blob||a(e.msgImageResizeError,v,"fileimageresizeerror")}catch(ct){u.val++;u.val===f&&e._raise("fileimagesresized",[undefined,undefined]);ft=e.msgImageResizeException.replace("{errors}",ct.message);a(ft,v,"fileimageresizeexception")}},_showProgress:function(){var n=this;n.$progress&&n.$progress.length&&n.$progress.show()},_hideProgress:function(){var n=this;n.$progress&&n.$progress.length&&n.$progress.hide()},_initBrowse:function(n){var i=this,r=i.$element;i.showBrowse?i.$btnFile=n.find(".btn-file").append(r):(r.appendTo(n).attr("tabindex",-1),t.addCss(r,"file-no-browse"))},_initClickable:function(){var i=this,r,u;i.isClickable&&(r=i.$dropZone,i.isAjaxUpload||(u=i.$preview.find(".file-default-preview"),u.length&&(r=u)),t.addCss(r,"clickable"),r.attr("tabindex",-1),i._handler(r,"click",function(t){var u=n(t.target);n(i.elErrorContainer+":visible").length||u.parents(".file-preview-thumbnails").length&&!u.parents(".file-default-preview").length||(i.$element.data("zoneClicked",!0).trigger("click"),r.blur())}))},_initCaption:function(){var n=this,i=n.initialCaption||"";return n.overwriteInitial||t.isEmpty(i)?(n.$caption.val(""),!1):(n._setCaption(i),!0)},_setCaption:function(i,r){var u=this,f,o,s,e,h,c;if(u.$caption.length){if(u.$captionContainer.removeClass("icon-visible"),r)f=n("<div>"+u.msgValidationError+"<\/div>").text(),e=u.fileManager.count(),e?(c=u.fileManager.getFirstFile(),h=e===1&&c?c.nameFmt:u._getMsgSelected(e)):h=u._getMsgSelected(u.msgNo),o=t.isEmpty(i)?h:i,s='<span class="'+u.msgValidationErrorClass+'">'+u.msgValidationErrorIcon+"<\/span>";else{if(t.isEmpty(i))return;f=n("<div>"+i+"<\/div>").text();o=f;s=u._getLayoutTemplate("fileIcon")}u.$captionContainer.addClass("icon-visible");u.$caption.attr("title",f).val(o);t.setHtml(u.$captionIcon,s)}},_createContainer:function(){var n=this,r={"class":"file-input file-input-new"+(n.rtl?" kv-rtl":"")},i=t.createElement(t.cspBuffer.stash(n._renderMain()));return t.cspBuffer.apply(i),i.insertBefore(n.$element).attr(r),n._initBrowse(i),n.theme&&i.addClass("theme-"+n.theme),i},_refreshContainer:function(){var n=this,i=n.$container,r=n.$element;r.insertAfter(i);t.setHtml(i,n._renderMain());n._initBrowse(i);n._validateDisabled()},_validateDisabled:function(){var n=this;n.$caption.attr({readonly:n.isDisabled})},_renderMain:function(){var n=this,t=n.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=n.showClose?n._getLayoutTemplate("close"):"",r=n.showPreview?n._getLayoutTemplate("preview").setTokens({"class":n.previewClass,dropClass:t}):"",u=n.isDisabled?n.captionClass+" file-caption-disabled":n.captionClass,f=n.captionTemplate.setTokens({"class":u+" kv-fileinput-caption"});return n.mainTemplate.setTokens({"class":n.mainClass+(!n.showBrowse&&n.showCaption?" no-browse":""),preview:r,close:i,caption:f,upload:n._renderButton("upload"),remove:n._renderButton("remove"),cancel:n._renderButton("cancel"),pause:n._renderButton("pause"),browse:n._renderButton("browse")})},_renderButton:function(n){var i=this,f=i._getLayoutTemplate("btnDefault"),r=i[n+"Class"],o=i[n+"Title"],s=i[n+"Icon"],u=i[n+"Label"],h=i.isDisabled?" disabled":"",e="button";switch(n){case"remove":if(!i.showRemove)return"";break;case"cancel":if(!i.showCancel)return"";r+=" kv-hidden";break;case"pause":if(!i.showPause)return"";r+=" kv-hidden";break;case"upload":if(!i.showUpload)return"";i.isAjaxUpload&&!i.isDisabled?f=i._getLayoutTemplate("btnLink").replace("{href}",i.uploadUrl):e="submit";break;case"browse":if(!i.showBrowse)return"";f=i._getLayoutTemplate("btnBrowse");break;default:return""}return r+=n==="browse"?" btn-file":" fileinput-"+n+" fileinput-"+n+"-button",t.isEmpty(u)||(u=' <span class="'+i.buttonLabelClass+'">'+u+"<\/span>"),f.setTokens({type:e,css:r,title:o,status:h,icon:s,label:u})},_renderThumbProgress:function(){var n=this;return'<div class="file-thumb-progress kv-hidden">'+n.progressInfoTemplate.setTokens({percent:101,status:n.msgUploadBegin,stats:""})+"<\/div>"},_renderFileFooter:function(n,i,r,u,f){var e=this,o=e.fileActionSettings,a=o.showRemove,h=o.showDrag,v=o.showUpload,c=o.showZoom,l,s,y=e._getLayoutTemplate("footer"),p=e._getLayoutTemplate("indicator"),w=f?o.indicatorError:o.indicatorNew,b=f?o.indicatorErrorTitle:o.indicatorNewTitle,k=p.setTokens({indicator:w,indicatorTitle:b});return r=e._getSize(r),s={type:n,caption:i,size:r,width:u,progress:"",indicator:k},e.isAjaxUpload?(s.progress=e._renderThumbProgress(),s.actions=e._renderFileActions(s,v,!1,a,c,h,!1,!1,!1)):s.actions=e._renderFileActions(s,!1,!1,!1,c,h,!1,!1,!1),l=y.setTokens(s),t.replaceTags(l,e.previewThumbTags)},_renderFileActions:function(n,t,i,r,u,f,e,o,s,h,c,l){var v=this;if(!n.type&&h&&(n.type="image"),v.enableResumableUpload?t=!1:typeof t=="function"&&(t=t(n)),typeof i=="function"&&(i=i(n)),typeof r=="function"&&(r=r(n)),typeof u=="function"&&(u=u(n)),typeof f=="function"&&(f=f(n)),!t&&!i&&!r&&!u&&!f)return"";var nt=o===!1?"":' data-url="'+o+'"',p="",w="",b,k=s===!1?"":' data-key="'+s+'"',d="",g="",y="",tt=v._getLayoutTemplate("actions"),a=v.fileActionSettings,it=v.otherActionButtons.setTokens({dataKey:k,key:s}),rt=e?a.removeClass+" disabled":a.removeClass;return r&&(d=v._getLayoutTemplate("actionDelete").setTokens({removeClass:rt,removeIcon:a.removeIcon,removeTitle:a.removeTitle,dataUrl:nt,dataKey:k,key:s})),t&&(g=v._getLayoutTemplate("actionUpload").setTokens({uploadClass:a.uploadClass,uploadIcon:a.uploadIcon,uploadTitle:a.uploadTitle})),i&&(y=v._getLayoutTemplate("actionDownload").setTokens({downloadClass:a.downloadClass,downloadIcon:a.downloadIcon,downloadTitle:a.downloadTitle,downloadUrl:c||v.initialPreviewDownloadUrl}),y=y.setTokens({filename:l,key:s})),u&&(p=v._getLayoutTemplate("actionZoom").setTokens({zoomClass:a.zoomClass,zoomIcon:a.zoomIcon,zoomTitle:a.zoomTitle})),f&&h&&(b="drag-handle-init "+a.dragClass,w=v._getLayoutTemplate("actionDrag").setTokens({dragClass:b,dragTitle:a.dragTitle,dragIcon:a.dragIcon})),tt.setTokens({"delete":d,upload:g,download:y,zoom:p,drag:w,other:it})},_browse:function(n){var t=this;n&&n.isDefaultPrevented()||!t._raise("filebrowse")||(t.isError&&!t.isAjaxUpload&&t.clear(),t.focusCaptionOnBrowse&&t.$captionContainer.focus())},_change:function(i){var r=this;if(!r.changeTriggered){var a=r.$element,k=arguments.length>1,u=r.isAjaxUpload,h,c=k?arguments[1]:a[0].files,v=r.fileManager.count(),o,l,f,y=t.isEmpty(a.attr("multiple")),e=!u&&y?1:r.maxFileCount,s=r.maxTotalFileCount,p=s>0&&s>e,w=y&&v>0,d=function(t,i,f,e){var o=n.extend(!0,{},r._getOutData(null,{},{},c),{id:f,index:e}),s={id:f,index:e,file:i,files:c};return r.isPersistentError=!0,u?r._showFileError(t,o):r._showError(t,s)},b=function(n,t,i){var u=i?r.msgTotalFilesTooMany:r.msgFilesTooMany;u=u.replace("{m}",t).replace("{n}",n);r.isError=d(u,null,null,null);r.$captionContainer.removeClass("icon-visible");r._setCaption("",!0);r.$container.removeClass("file-input-new file-input-ajax-new")};if(r.reader=null,r._resetUpload(),r._hideFileIcon(),r.dropZoneEnabled&&r.$container.find(".file-drop-zone ."+r.dropZoneTitleClass).remove(),u||(c=i.target&&i.target.files===undefined?i.target.value?[{name:i.target.value.replace(/^.+\\/,"")}]:[]:i.target.files||{}),h=c,t.isEmpty(h)||h.length===0){u||r.clear();r._raise("fileselectnone");return}if(r._resetErrors(),f=h.length,l=u?r.fileManager.count()+f:f,o=r._getFileCount(l,p?!1:undefined),e>0&&o>e){if(!r.autoReplace||f>e){b(r.autoReplace&&f>e?f:o,e);return}o>e&&r._resetPreviewThumbs(u)}else{if(p&&(o=r._getFileCount(l,!0),s>0&&o>s)){if(!r.autoReplace||f>e){b(r.autoReplace&&f>s?f:o,s,!0);return}o>e&&r._resetPreviewThumbs(u)}!u||w?(r._resetPreviewThumbs(!1),w&&r.clearFileStack()):u&&v===0&&(!r.previewCache.count(!0)||r.overwriteInitial)&&r._resetPreviewThumbs(!0)}r.readFiles(h)}},_abort:function(t){var i=this,r;return i.ajaxAborted&&typeof i.ajaxAborted=="object"&&i.ajaxAborted.message!==undefined?(r=n.extend(!0,{},i._getOutData(null),t),r.abortData=i.ajaxAborted.data||{},r.abortMessage=i.ajaxAborted.message,i._setProgress(101,i.$progress,i.msgCancelled),i._showFileError(i.ajaxAborted.message,r,"filecustomerror"),i.cancel(),!0):!!i.ajaxAborted},_resetFileStack:function(){var t=this,i=0;t._getThumbs().each(function(){var r=n(this),u=r.attr("data-fileindex"),f=r.attr("id");u!=="-1"&&u!==-1&&(t.fileManager.getFile(r.attr("data-fileid"))?r.attr({"data-fileindex":"-1"}):(r.attr({"data-fileindex":i}),i++),t._getZoom(f).attr({"data-fileindex":r.attr("data-fileindex")}))})},_isFileSelectionValid:function(n){var t=this;return(n=n||0,t.required&&!t.getFilesCount())?(t.$errorContainer.html(""),t._showFileError(t.msgFileRequired),!1):t.minFileCount>0&&t._getFileCount(n)<t.minFileCount?(t._noFilesError({}),!1):!0},_canPreview:function(n){var i=this;if(!n||!i.showPreview||!i.$preview||!i.$preview.length)return!1;var r=n.name||"",u=n.type||"",b=(n.size||0)/1e3,e=i._parseFileType(u,r),o,s,h,c,l=i.allowedPreviewTypes,a=i.allowedPreviewMimeTypes,v=i.allowedPreviewExtensions||[],y=i.disabledPreviewTypes,p=i.disabledPreviewMimeTypes,w=i.disabledPreviewExtensions||[],f=i.maxFilePreviewSize&&parseFloat(i.maxFilePreviewSize)||0,k=new RegExp("\\.("+v.join("|")+")$","i"),d=new RegExp("\\.("+w.join("|")+")$","i");return o=!l||l.indexOf(e)!==-1,s=!a||a.indexOf(u)!==-1,h=!v.length||t.compare(r,k),c=y&&y.indexOf(e)!==-1||p&&p.indexOf(u)!==-1||w.length&&t.compare(r,d)||f&&!isNaN(f)&&b>f,!c&&(o||s||h)},addToStack:function(n,t){this.fileManager.add(n,t)},clearFileStack:function(){var n=this;return n.fileManager.clear(),n._initResumableUpload(),n.enableResumableUpload?(n.showPause===null&&(n.showPause=!0),n.showCancel===null&&(n.showCancel=!1)):(n.showPause=!1,n.showCancel===null&&(n.showCancel=!0)),n.$element},getFileStack:function(){return this.fileManager.stack},getFileList:function(){return this.fileManager.list()},getFilesCount:function(n){var t=this,i=t.isAjaxUpload?t.fileManager.count():t._inputFileCount();return n&&(i+=t.previewCache.count(!0)),t._getFileCount(i)},readFiles:function(i){this.reader=new FileReader;var r=this,u=r.reader,c=r.$previewContainer,s=r.$previewStatus,p=r.msgLoading,v=r.msgProgress,w=r.previewInitId,f=i.length,l=r.fileTypeSettings,e,o=r.allowedFileTypes,y=o?o.length:0,h=r.allowedFileExtensions,b=t.isEmpty(h)?"":h.join(", "),a=function(t,u,o,s,h){var c,l=n.extend(!0,{},r._getOutData(null,{},{},i),{id:o,index:s,fileId:h}),a={id:o,index:s,fileId:h,file:u,files:i};r._previewDefault(u,!0);c=r._getFrame(o,!0);r.isAjaxUpload?setTimeout(function(){e(s+1)},r.processDelay):(r.unlock(),f=0);r.removeFromPreviewOnError&&c.length?c.remove():(r._initFileActions(),c.find(".kv-file-upload").remove());r.isPersistentError=!0;r.isError=r.isAjaxUpload?r._showFileError(t,l):r._showError(t,a);r._updateFileDetails(f)};r.fileManager.clearImages();n.each(i,function(n,t){var i=r.fileTypeSettings.image;i&&i(t.type)&&r.fileManager.totalImages++});e=function(k){var ut=r.$errorContainer,vt,ft=r.fileManager,si;if(k>=f){r.unlock();r.duplicateErrors.length&&(vt="<li>"+r.duplicateErrors.join("<\/li><li>")+"<\/li>",ut.find("ul").length===0?t.setHtml(ut,r.errorCloseButton+"<ul>"+vt+"<\/ul>"):ut.find("ul").append(vt),ut.fadeIn(r.fadeDelay),r._handler(ut.find(".kv-error-close"),"click",function(){ut.fadeOut(r.fadeDelay)}),r.duplicateErrors=[]);r.isAjaxUpload?(r._raise("filebatchselected",[ft.stack]),ft.count()!==0||r.isError||r.reset()):r._raise("filebatchselected",[i]);c.removeClass("file-thumb-loading");s.html("");return}r.lock(!0);var d=i[k],it=w+"-"+r._getFileId(d),et,tt,nt,ni=l.text,ti=l.image,ii=l.html,ri,yt,pt,wt,g=r._getFileName(d,""),bt=(d&&d.size||0)/1e3,kt="",ui=t.createObjectURL(d),ot=0,fi="",rt,st,dt=!1,ht,ei=0,ct,lt,at,gt,oi=function(){var n=v.setTokens({index:k+1,files:f,percent:50,name:g});setTimeout(function(){s.html(n);r._updateFileDetails(f);e(k+1)},r.processDelay);r._raise("fileloaded",[d,it,k,u])&&r.isAjaxUpload&&ft.add(d)};if(d){if(rt=ft.getId(d),y>0)for(tt=0;tt<y;tt++)pt=o[tt],wt=r.msgFileTypes[pt]||pt,fi+=tt===0?wt:", "+wt;if(g===!1){e(k+1);return}if(g.length===0){nt=r.msgInvalidFileName.replace("{name}",t.htmlEncode(t.getFileName(d),"[unknown]"));a(nt,d,it,k,rt);return}if(t.isEmpty(h)||(kt=new RegExp("\\.("+h.join("|")+")$","i")),et=bt.toFixed(2),r.isAjaxUpload&&ft.exists(rt)||r._getFrame(it,!0).length){si={id:it,index:k,fileId:rt,file:d,files:i};nt=r.msgDuplicateFile.setTokens({name:g,size:et});r.isAjaxUpload?(r.duplicateErrors.push(nt),r.isDuplicateError=!0,r._raise("fileduplicateerror",[d,rt,g,et,it,k]),e(k+1),r._updateFileDetails(f)):(r._showError(nt,si),r.unlock(),f=0,r._clearFileInput(),r.reset(),r._updateFileDetails(f));return}if(r.maxFileSize>0&&bt>r.maxFileSize){nt=r.msgSizeTooLarge.setTokens({name:g,size:et,maxSize:r.maxFileSize});a(nt,d,it,k,rt);return}if(r.minFileSize!==null&&bt<=t.getNum(r.minFileSize)){nt=r.msgSizeTooSmall.setTokens({name:g,size:et,minSize:r.minFileSize});a(nt,d,it,k,rt);return}if(!t.isEmpty(o)&&t.isArray(o)){for(tt=0;tt<o.length;tt+=1)ri=o[tt],ht=l[ri],ot+=!ht||typeof ht!="function"?0:ht(d.type,t.getFileName(d))?1:0;if(ot===0){nt=r.msgInvalidFileType.setTokens({name:g,types:fi});a(nt,d,it,k,rt);return}}if(ot===0&&!t.isEmpty(h)&&t.isArray(h)&&!t.isEmpty(kt)&&(yt=t.compare(g,kt),ot+=t.isEmpty(yt)?0:yt.length,ot===0)){nt=r.msgInvalidFileExtension.setTokens({name:g,extensions:b});a(nt,d,it,k,rt);return}if(!r._canPreview(d)){st=r.isAjaxUpload&&r._raise("filebeforeload",[d,k,u]);r.isAjaxUpload&&st&&ft.add(d);r.showPreview&&st&&(c.addClass("file-thumb-loading"),r._previewDefault(d),r._initFileActions());setTimeout(function(){st&&r._updateFileDetails(f);e(k+1);r._raise("fileloaded",[d,it,k])},10);return}ct=ni(d.type,g);lt=ii(d.type,g);at=ti(d.type,g);s.html(p.replace("{index}",k+1).replace("{files}",f));c.addClass("file-thumb-loading");u.onerror=function(n){r._errorHandler(n,g)};u.onload=function(i){var o,e,h,v,y=[],a,f,p=function(n){var t=new FileReader;t.onerror=function(n){r._errorHandler(n,g)};t.onload=function(n){if(r.isAjaxUpload&&!r._raise("filebeforeload",[d,k,u])){dt=!0;r._resetCaption();u.abort();s.html("");c.removeClass("file-thumb-loading");r.enable();return}r._previewFile(k,d,n,ui,e);r._initFileActions();oi()};n?t.readAsText(d,r.textEncoding):t.readAsDataURL(d)};if(e={name:g,type:d.type},n.each(l,function(n,t){n!=="object"&&n!=="other"&&typeof t=="function"&&t(d.type,g)&&ei++}),ei===0){for(h=new Uint8Array(i.target.result),tt=0;tt<h.length;tt++)v=h[tt].toString(16),y.push(v);if(o=y.join("").toLowerCase().substring(0,8),f=t.getMimeType(o,"",""),t.isEmpty(f)&&(a=t.arrayBuffer2String(u.result),f=t.isSvg(a)?"image/svg+xml":t.getMimeType(o,a,d.type)),e={name:g,type:f},ct=ni(f,""),lt=ii(f,""),at=ti(f,""),gt=ct||lt,gt||at){p(gt);return}}if(r.isAjaxUpload&&!r._raise("filebeforeload",[d,k,u])){dt=!0;r._resetCaption();u.abort();s.html("");c.removeClass("file-thumb-loading");r.enable();return}r._previewFile(k,d,i,ui,e);r._initFileActions();oi()};u.onprogress=function(n){if(n.lengthComputable){var t=n.loaded/n.total*100,i=Math.ceil(t);nt=v.setTokens({index:k+1,files:f,percent:i,name:g});setTimeout(function(){dt||s.html(nt)},r.processDelay)}};ct||lt?u.readAsText(d,r.textEncoding):at?u.readAsDataURL(d):u.readAsArrayBuffer(d)}};e(0);r._updateFileDetails(f,!0)},lock:function(n){var t=this,i=t.$container;return t._resetErrors(),t.disable(),!n&&t.showCancel&&i.find(".fileinput-cancel").show(),!n&&t.showPause&&i.find(".fileinput-pause").show(),t._raise("filelock",[t.fileManager.stack,t._getExtraData()]),t.$element},unlock:function(n){var t=this,i=t.$container;return n===undefined&&(n=!0),t.enable(),i.removeClass("is-locked"),t.showCancel&&i.find(".fileinput-cancel").hide(),t.showPause&&i.find(".fileinput-pause").hide(),n&&t._resetFileStack(),t._raise("fileunlock",[t.fileManager.stack,t._getExtraData()]),t.$element},resume:function(){var n=this,t=!1,i=n.resumableManager;return n.enableResumableUpload?(n.paused?n._toggleResumableProgress(n.progressPauseTemplate,n.msgUploadResume):t=!0,n.paused=!1,t&&n._toggleResumableProgress(n.progressInfoTemplate,n.msgUploadBegin),setTimeout(function(){i.upload()},n.processDelay),n.$element):n.$element},pause:function(){var t=this,r=t.resumableManager,u=t.ajaxRequests,f=u.length,i,e=r.getProgress(),s=t.fileActionSettings,h=t.taskManager,o=h.getPool(r.id);if(t.enableResumableUpload)o&&o.cancel();else return t.$element;if(t._raise("fileuploadpaused",[t.fileManager,r]),f>0)for(i=0;i<f;i+=1)t.paused=!0,u[i].abort();return t.showPreview&&t._getThumbs().each(function(){var i=n(this),u=i.attr("data-fileid"),f=t._getLayoutTemplate("stats"),r,o=i.find(".file-upload-indicator");i.removeClass("file-uploading");o.attr("title")===s.indicatorLoadingTitle&&(t._setThumbStatus(i,"Paused"),r=f.setTokens({pendingTime:t.msgPaused,uploadSpeed:""}),t.paused=!0,t._setProgress(e,i.find(".file-thumb-progress"),e+"%",r));t.fileManager.getFile(u)||i.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")}),t._setProgress(101,t.$progress,t.msgPaused),t.$element},cancel:function(){var t=this,u=t.ajaxRequests,i=t.resumableManager,o=t.taskManager,f=i?o.getPool(i.id):undefined,e=u.length,r;if(t.enableResumableUpload&&f?(f.cancel().done(function(){t._setProgressCancelled()}),i.reset(),t._raise("fileuploadcancelled",[t.fileManager,i])):t._raise("fileuploadcancelled",[t.fileManager]),t._initAjax(),e>0)for(r=0;r<e;r+=1)t.cancelling=!0,u[r].abort();return t._getThumbs().each(function(){var i=n(this),u=i.attr("data-fileid"),r=i.find(".file-thumb-progress");i.removeClass("file-uploading");t._setProgress(0,r);r.hide();t.fileManager.getFile(u)||(i.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),i.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));t.unlock()}),setTimeout(function(){t._setProgressCancelled()},t.processDelay),t.$element},clear:function(){var i=this,r;if(i._raise("fileclear"))return i.$btnUpload.removeAttr("disabled"),i._getThumbs().find("video,audio,img").each(function(){t.cleanMemory(n(this))}),i._clearFileInput(),i._resetUpload(),i.clearFileStack(),i.isDuplicateError=!1,i.isPersistentError=!1,i._resetErrors(!0),i._hasInitialPreview()?(i._showFileIcon(),i._resetPreview(),i._initPreviewActions(),i.$container.removeClass("file-input-new")):(i._getThumbs().each(function(){i._clearObjects(n(this))}),i.isAjaxUpload&&(i.previewCache.data={}),i.$preview.html(""),r=!i.overwriteInitial&&i.initialCaption.length>0?i.initialCaption:"",i.$caption.attr("title","").val(r),t.addCss(i.$container,"file-input-new"),i._validateDefaultPreview()),i.$container.find(t.FRAMES).length===0&&(i._initCaption()||i.$captionContainer.removeClass("icon-visible")),i._hideFileIcon(),i.focusCaptionOnClear&&i.$captionContainer.focus(),i._setFileDropZoneTitle(),i._raise("filecleared"),i.$element},reset:function(){var n=this;if(n._raise("filereset"))return n.lastProgress=0,n._resetPreview(),n.$container.find(".fileinput-filename").text(""),t.addCss(n.$container,"file-input-new"),n.getFrames().length&&n.$container.removeClass("file-input-new"),n.clearFileStack(),n._setFileDropZoneTitle(),n.$element},disable:function(){var n=this,i=n.$container;return n.isDisabled=!0,n._raise("filedisabled"),n.$element.attr("disabled","disabled"),i.addClass("is-locked"),t.addCss(i.find(".btn-file"),"disabled"),i.find(".kv-fileinput-caption").addClass("file-caption-disabled"),i.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),n._initDragDrop(),n.$element},enable:function(){var n=this,t=n.$container;return n.isDisabled=!1,n._raise("fileenabled"),n.$element.removeAttr("disabled"),t.removeClass("is-locked"),t.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),t.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),t.find(".btn-file").removeClass("disabled"),n._initDragDrop(),n.$element},upload:function(){var i=this,f=i.fileManager,r=f.count(),u,e,o=!n.isEmptyObject(i._getExtraData());if(i.isAjaxUpload&&!i.isDisabled&&i._isFileSelectionValid(r)){if(i.lastProgress=0,i._resetUpload(),r===0&&!o){i._showFileError(i.msgUploadEmpty);return}if(i.cancelling=!1,i._showProgress(),i.lock(),r===0&&o){i._setProgress(2);i._uploadExtraOnly();return}if(i.enableResumableUpload)return i.resume();if((i.uploadAsync||i.enableResumableUpload)&&(e=i._getOutData(null),i._raise("filebatchpreupload",[e]),i.fileBatchCompleted=!1,i.uploadCache=[],n.each(i.getFileStack(),function(n){var t=i._getThumbId(n);i.uploadCache.push({id:t,content:null,config:null,tags:null,append:!0})}),i.$preview.find(".file-preview-initial").removeClass(t.SORT_CSS),i._initSortable()),i._setProgress(2),i.hasInitData=!1,i.uploadAsync){u=0;n.each(f.stack,function(n){i._uploadSingle(u,n,!0);u++});return}return i._uploadBatch(),i.$element}},destroy:function(){var t=this,r=t.$form,u=t.$container,f=t.$element,i=t.namespace;return n(document).off(i),n(window).off(i),r&&r.length&&r.off(i),t.isAjaxUpload&&t._clearFileInput(),t._cleanup(),t._initPreviewCache(),f.insertBefore(u).off(i).removeData(),u.off().remove(),f},refresh:function(i){var r=this,u=r.$element;return i=typeof i!="object"||t.isEmpty(i)?r.options:n.extend(!0,{},r.options,i),r._init(i,!0),r._listen(),u},zoom:function(n){var t=this,i=t._getFrame(n);t._showModal(i)},getExif:function(n){var i=this,t=i._getFrame(n);return t&&t.data("exif")||null},getFrames:function(i){var u=this,r;return i=i||"",r=u.$preview.find(t.FRAMES+i),u.reversePreviewOrder&&(r=n(r.get().reverse())),r},getPreview:function(){var n=this;return{content:n.initialPreview,config:n.initialPreviewConfig,tags:n.initialPreviewThumbTags}}};n.fn.fileinput=function(r){if(t.hasFileAPISupport()||t.isIE(9)){var f=Array.apply(null,arguments),u=[];f.shift();this.each(function(){var e=n(this),o=e.data("fileinput"),s=typeof r=="object"&&r,c=s.theme||e.data("theme"),l={},a={},h=s.language||e.data("language")||n.fn.fileinput.defaults.language||"en",v;o||(c&&(a=n.fn.fileinputThemes[c]||{}),h==="en"||t.isEmpty(n.fn.fileinputLocales[h])||(l=n.fn.fileinputLocales[h]||{}),v=n.extend(!0,{},n.fn.fileinput.defaults,a,n.fn.fileinputLocales.en,l,s,e.data()),o=new i(this,v),e.data("fileinput",o));typeof r=="string"&&u.push(o[r].apply(o,f))});switch(u.length){case 0:return this;case 1:return u[0];default:return u}}};r='class="kv-preview-data file-preview-pdf" src="{renderer}?file={data}" {style}';n.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showUploadStats:!0,showCancel:null,showPause:null,showClose:!0,showUploadedThumbs:!0,showConsoleLogs:!1,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:function(){var n=window.navigator.userAgent,t=!!n.match(/WebKit/i),i=!!n.match(/iP(od|ad|hone)/i),r=i&&t&&!n.match(/CriOS/i);return!r},autoOrientImageInitial:!0,required:!1,rtl:!1,hideThumbnailContent:!1,encodeUrl:!0,focusCaptionOnBrowse:!0,focusCaptionOnClear:!0,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,sanitizeZoomCache:function(n){var i=t.createElement(n);return i.find("input,textarea,select,datalist,form,.file-thumbnail-footer").remove(),i.html()},previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"><\/i>',next:'<i class="glyphicon glyphicon-triangle-right"><\/i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"><\/i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"><\/i>',borderless:'<i class="glyphicon glyphicon-resize-full"><\/i>',close:'<i class="glyphicon glyphicon-remove"><\/i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-sm btn-kv btn-default btn-outline-secondary",fullscreen:"btn btn-sm btn-kv btn-default btn-outline-secondary",borderless:"btn btn-sm btn-kv btn-default btn-outline-secondary",close:"btn btn-sm btn-kv btn-default btn-outline-secondary"},previewTemplates:{},previewContentTemplates:{},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedFileTypes:null,allowedFileExtensions:null,allowedPreviewTypes:undefined,allowedPreviewMimeTypes:null,allowedPreviewExtensions:null,disabledPreviewTypes:undefined,disabledPreviewExtensions:["msi","exe","com","zip","rar","app","vb","scr"],disabledPreviewMimeTypes:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"><\/i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"><\/i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"><\/i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"><\/i>',cancelClass:"btn btn-default btn-secondary",pauseIcon:'<i class="glyphicon glyphicon-pause"><\/i>',pauseClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"><\/i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadParamNames:{chunkCount:"chunkCount",chunkIndex:"chunkIndex",chunkSize:"chunkSize",chunkSizeStart:"chunkSizeStart",chunksUploaded:"chunksUploaded",fileBlob:"fileBlob",fileId:"fileId",fileName:"fileName",fileRelativePath:"fileRelativePath",fileSize:"fileSize",retryCount:"retryCount"},maxAjaxThreads:5,fadeDelay:800,processDelay:100,queueDelay:10,progressDelay:0,enableResumableUpload:!1,resumableUploadOptions:{fallback:null,testUrl:null,chunkSize:2048,maxThreads:4,maxRetries:3,showErrorLog:!0},uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,maxTotalFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"><\/i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressInfoClass:"progress-bar bg-info progress-bar-info progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressPauseClass:"progress-bar bg-primary progress-bar-primary progress-bar-striped active",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:t.closeButton("kv-error-close"),slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0,reversePreviewOrder:!1,usePdfRenderer:function(){var n=!!window.MSInputMethodContext&&!!document.documentMode;return!!navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/i)||n},pdfRendererUrl:"",pdfRendererTemplate:"<iframe "+r+"><\/iframe>"};n.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear all unprocessed files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",pauseLabel:"Pause",pauseTitle:"Pause ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgPaused:"Paused",msgPlaceholder:"Select {files} ...",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB<\/b>) is too small and must be larger than <b>{minSize} KB<\/b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB<\/b>) exceeds maximum allowed upload size of <b>{maxSize} KB<\/b>.',msgFilesTooLess:"You must select at least <b>{n}<\/b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})<\/b> exceeds maximum allowed limit of <b>{m}<\/b>.",msgTotalFilesTooMany:"You can upload a maximum of <b>{m}<\/b> files (<b>{n}<\/b> files detected).",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing &hellip;",msgUploadBegin:"Initializing &hellip;",msgUploadEnd:"Done",msgUploadResume:"Resuming upload &hellip;",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Upload Error",msgDeleteError:"Delete Error",msgProgressError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}<\/pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",msgDuplicateFile:'File "{name}" of same size "{size} KB" has already been selected earlier. Skipping duplicate selection.',msgResumableUploadRetriesExceeded:"Upload aborted beyond <b>{max}<\/b> retries for file <b>{file}<\/b>! Error Details: <pre>{error}<\/pre>",msgPendingTime:"{time} remaining",msgCalculatingTime:"calculating time remaining",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}};n.fn.fileinput.Constructor=i;n(document).ready(function(){var t=n("input.file[type=file]");t.length&&t.fileinput()})});