import*as L from"leaflet";function geocodingParams(e,t){return L.Util.extend(t,e.geocodingQueryParams)}function reverseParams(e,t){return L.Util.extend(t,e.reverseQueryParams)}let lastCallbackId=0;const badChars=/[&<>"'`]/g,possible=/[&<>"'`]/,escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};function escapeChar(e){return escape[e]}function htmlEscape(e){return null==e?"":e?(e=""+e,possible.test(e)?e.replace(badChars,escapeChar):e):e+""}function jsonp(e,t,o,s,n){var i="_l_geocoder_"+lastCallbackId++;t[n||"callback"]=i,window[i]=L.Util.bind(o,s);const r=document.createElement("script");r.type="text/javascript",r.src=e+getParamString(t),r.id=i,document.getElementsByTagName("head")[0].appendChild(r)}function getJSON(e,t,o){const s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState){let t;if(200!==s.status&&304!==s.status)t="";else if("string"==typeof s.response)try{t=JSON.parse(s.response)}catch(e){t=s.response}else t=s.response;o(t)}},s.open("GET",e+getParamString(t),!0),s.responseType="json",s.setRequestHeader("Accept","application/json"),s.send(null)}function template(e,s){return e.replace(/\{ *([\w_]+) *\}/g,(e,t)=>{let o=s[t];return void 0===o?o="":"function"==typeof o&&(o=o(s)),htmlEscape(o)})}function getParamString(e,t,o){const s=[];for(const r in e){var n=encodeURIComponent(o?r.toUpperCase():r),i=e[r];if(Array.isArray(i))for(let e=0;e<i.length;e++)s.push(n+"="+encodeURIComponent(i[e]));else s.push(n+"="+encodeURIComponent(String(i)))}return(t&&-1!==t.indexOf("?")?"&":"?")+s.join("&")}class ArcGis{constructor(e){this.options={serviceUrl:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",apiKey:""},L.Util.setOptions(this,e)}geocode(e,r,a){e=geocodingParams(this.options,{token:this.options.apiKey,SingleLine:e,outFields:"Addr_Type",forStorage:!1,maxLocations:10,f:"json"});getJSON(this.options.serviceUrl+"/findAddressCandidates",e,t=>{const o=[];if(t.candidates&&t.candidates.length)for(let e=0;e<=t.candidates.length-1;e++){var s=t.candidates[e],n=L.latLng(s.location.y,s.location.x),i=L.latLngBounds(L.latLng(s.extent.ymax,s.extent.xmax),L.latLng(s.extent.ymin,s.extent.xmin));o[e]={name:s.address,bbox:i,center:n}}r.call(a,o)})}suggest(e,t,o){return this.geocode(e,t,o)}reverse(e,t,n,i){e=reverseParams(this.options,{location:e.lng+","+e.lat,distance:100,f:"json"});getJSON(this.options.serviceUrl+"/reverseGeocode",e,e=>{const t=[];var o,s;e&&!e.error&&(o=L.latLng(e.location.y,e.location.x),s=L.latLngBounds(o,o),t.push({name:e.address.Match_addr,center:o,bbox:s})),n.call(i,t)})}}function arcgis(e){return new ArcGis(e)}class Bing{constructor(e){this.options={serviceUrl:"https://dev.virtualearth.net/REST/v1/Locations"},L.Util.setOptions(this,e)}geocode(e,i,r){e=geocodingParams(this.options,{query:e,key:this.options.apiKey});jsonp(this.options.apiKey,e,t=>{const o=[];if(0<t.resourceSets.length)for(let e=t.resourceSets[0].resources.length-1;0<=e;e--){var s=t.resourceSets[0].resources[e],n=s.bbox;o[e]={name:s.name,bbox:L.latLngBounds([n[0],n[1]],[n[2],n[3]]),center:L.latLng(s.point.coordinates)}}i.call(r,o)},this,"jsonp")}reverse(e,t,i,r){var o=reverseParams(this.options,{key:this.options.apiKey});jsonp(this.options.serviceUrl+e.lat+","+e.lng,o,t=>{const o=[];for(let e=t.resourceSets[0].resources.length-1;0<=e;e--){var s=t.resourceSets[0].resources[e],n=s.bbox;o[e]={name:s.name,bbox:L.latLngBounds([n[0],n[1]],[n[2],n[3]]),center:L.latLng(s.point.coordinates)}}i.call(r,o)},this,"jsonp")}}function bing(e){return new Bing(e)}class Google{constructor(e){this.options={serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json"},L.Util.setOptions(this,e)}geocode(e,r,a){e=geocodingParams(this.options,{key:this.options.apiKey,address:e});getJSON(this.options.serviceUrl,e,t=>{const o=[];if(t.results&&t.results.length)for(let e=0;e<=t.results.length-1;e++){var s=t.results[e],n=L.latLng(s.geometry.location),i=L.latLngBounds(L.latLng(s.geometry.viewport.northeast),L.latLng(s.geometry.viewport.southwest));o[e]={name:s.formatted_address,bbox:i,center:n,properties:s.address_components}}r.call(a,o)})}reverse(e,t,r,a){e=reverseParams(this.options,{key:this.options.apiKey,latlng:e.lat+","+e.lng});getJSON(this.options.serviceUrl,e,t=>{const o=[];if(t.results&&t.results.length)for(let e=0;e<=t.results.length-1;e++){var s=t.results[e],n=L.latLng(s.geometry.location),i=L.latLngBounds(L.latLng(s.geometry.viewport.northeast),L.latLng(s.geometry.viewport.southwest));o[e]={name:s.formatted_address,bbox:i,center:n,properties:s.address_components}}r.call(a,o)})}}function google(e){return new Google(e)}class HERE{constructor(e){if(this.options={serviceUrl:"https://geocoder.api.here.com/6.2/",app_id:"",app_code:"",apiKey:"",maxResults:5},L.Util.setOptions(this,e),e.apiKey)throw Error("apiKey is not supported, use app_id/app_code instead!")}geocode(e,t,o){e=geocodingParams(this.options,{searchtext:e,gen:9,app_id:this.options.app_id,app_code:this.options.app_code,jsonattributes:1,maxresults:this.options.maxResults});this.getJSON(this.options.serviceUrl+"geocode.json",e,t,o)}reverse(e,t,o,s){let n=e.lat+","+e.lng;this.options.reverseGeocodeProxRadius&&(n+=","+this.options.reverseGeocodeProxRadius);e=reverseParams(this.options,{prox:n,mode:"retrieveAddresses",app_id:this.options.app_id,app_code:this.options.app_code,gen:9,jsonattributes:1,maxresults:this.options.maxResults});this.getJSON(this.options.serviceUrl+"reversegeocode.json",e,o,s)}getJSON(e,t,r,a){getJSON(e,t,t=>{const o=[];if(t.response.view&&t.response.view.length)for(let e=0;e<=t.response.view[0].result.length-1;e++){var s=t.response.view[0].result[e].location,n=L.latLng(s.displayPosition.latitude,s.displayPosition.longitude),i=L.latLngBounds(L.latLng(s.mapView.topLeft.latitude,s.mapView.topLeft.longitude),L.latLng(s.mapView.bottomRight.latitude,s.mapView.bottomRight.longitude));o[e]={name:s.address.label,properties:s.address,bbox:i,center:n}}r.call(a,o)})}}class HEREv2{constructor(e){this.options={serviceUrl:"https://geocode.search.hereapi.com/v1",apiKey:"",app_id:"",app_code:"",maxResults:10},L.Util.setOptions(this,e)}geocode(e,t,o){e=geocodingParams(this.options,{q:e,apiKey:this.options.apiKey,limit:this.options.maxResults});if(!e.at&&!e.in)throw Error("at / in parameters not found. Please define coordinates (at=latitude,longitude) or other (in) in your geocodingQueryParams.");this.getJSON(this.options.serviceUrl+"/discover",e,t,o)}reverse(e,t,o,s){e=reverseParams(this.options,{at:e.lat+","+e.lng,limit:this.options.reverseGeocodeProxRadius,apiKey:this.options.apiKey});this.getJSON(this.options.serviceUrl+"/revgeocode",e,o,s)}getJSON(e,t,r,a){getJSON(e,t,o=>{const s=[];if(o.items&&o.items.length)for(let t=0;t<=o.items.length-1;t++){var n=o.items[t],i=L.latLng(n.position.lat,n.position.lng);let e;e=n.mapView?L.latLngBounds(L.latLng(n.mapView.south,n.mapView.west),L.latLng(n.mapView.north,n.mapView.east)):L.latLngBounds(L.latLng(n.position.lat,n.position.lng),L.latLng(n.position.lat,n.position.lng)),s[t]={name:n.address.label,properties:n.address,bbox:e,center:i}}r.call(a,s)})}}function here(e){return new(e.apiKey?HEREv2:HERE)(e)}function parseLatLng(e){let t;return(t=e.match(/^([NS])\s*(\d{1,3}(?:\.\d*)?)\W*([EW])\s*(\d{1,3}(?:\.\d*)?)$/))?L.latLng((/N/i.test(t[1])?1:-1)*+t[2],(/E/i.test(t[3])?1:-1)*+t[4]):(t=e.match(/^(\d{1,3}(?:\.\d*)?)\s*([NS])\W*(\d{1,3}(?:\.\d*)?)\s*([EW])$/))?L.latLng((/N/i.test(t[2])?1:-1)*+t[1],(/E/i.test(t[4])?1:-1)*+t[3]):(t=e.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?$/))?L.latLng((/N/i.test(t[1])?1:-1)*(+t[2]+ +t[3]/60),(/E/i.test(t[4])?1:-1)*(+t[5]+ +t[6]/60)):(t=e.match(/^(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([NS])\W*(\d{1,3})°?\s*(\d{1,3}(?:\.\d*)?)?['′]?\s*([EW])$/))?L.latLng((/N/i.test(t[3])?1:-1)*(+t[1]+ +t[2]/60),(/E/i.test(t[6])?1:-1)*(+t[4]+ +t[5]/60)):(t=e.match(/^([NS])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\W*([EW])\s*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?$/))?L.latLng((/N/i.test(t[1])?1:-1)*(+t[2]+ +t[3]/60+ +t[4]/3600),(/E/i.test(t[5])?1:-1)*(+t[6]+ +t[7]/60+ +t[8]/3600)):(t=e.match(/^(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]\s*([NS])\W*(\d{1,3})°?\s*(\d{1,2})['′]?\s*(\d{1,3}(?:\.\d*)?)?["″]?\s*([EW])$/))?L.latLng((/N/i.test(t[4])?1:-1)*(+t[1]+ +t[2]/60+ +t[3]/3600),(/E/i.test(t[8])?1:-1)*(+t[5]+ +t[6]/60+ +t[7]/3600)):(t=e.match(/^\s*([+-]?\d+(?:\.\d*)?)\s*[\s,]\s*([+-]?\d+(?:\.\d*)?)\s*$/))?L.latLng(+t[1],+t[2]):void 0}class LatLng{constructor(e){this.options={next:void 0,sizeInMeters:1e4},L.Util.setOptions(this,e)}geocode(e,t,o){const s=parseLatLng(e);var n;s?(n=[{name:e,center:s,bbox:s.toBounds(this.options.sizeInMeters)}],t.call(o,n)):this.options.next&&this.options.next.geocode(e,t,o)}}function latLng(e){return new LatLng(e)}class Mapbox{constructor(e){this.options={serviceUrl:"https://api.mapbox.com/geocoding/v5/mapbox.places/"},L.Util.setOptions(this,e)}_getProperties(t){const o={text:t.text,address:t.address};for(let e=0;e<(t.context||[]).length;e++){var s=t.context[e].id.split(".")[0];o[s]=t.context[e].text,t.context[e].short_code&&(o.countryShortCode=t.context[e].short_code)}return o}geocode(e,t,r){const o=geocodingParams(this.options,{access_token:this.options.apiKey});void 0!==o.proximity&&void 0!==o.proximity.lat&&void 0!==o.proximity.lng&&(o.proximity=o.proximity.lng+","+o.proximity.lat),getJSON(this.options.serviceUrl+encodeURIComponent(e)+".json",o,o=>{const s=[];if(o.features&&o.features.length)for(let t=0;t<=o.features.length-1;t++){const i=o.features[t];var n=L.latLng(i.center.reverse());let e;e=i.bbox?L.latLngBounds(L.latLng(i.bbox.slice(0,2).reverse()),L.latLng(i.bbox.slice(2,4).reverse())):L.latLngBounds(n,n),s[t]={name:i.place_name,bbox:e,center:n,properties:this._getProperties(i)}}t.call(r,s)})}suggest(e,t,o){return this.geocode(e,t,o)}reverse(e,t,r,a){getJSON(this.options.serviceUrl+e.lng+","+e.lat+".json",reverseParams(this.options,{access_token:this.options.apiKey}),o=>{const s=[];if(o.features&&o.features.length)for(let t=0;t<=o.features.length-1;t++){const i=o.features[t];var n=L.latLng(i.center.reverse());let e;e=i.bbox?L.latLngBounds(L.latLng(i.bbox.slice(0,2).reverse()),L.latLng(i.bbox.slice(2,4).reverse())):L.latLngBounds(n,n),s[t]={name:i.place_name,bbox:e,center:n,properties:this._getProperties(i)}}r.call(a,s)})}}function mapbox(e){return new Mapbox(e)}class MapQuest{constructor(e){this.options={serviceUrl:"https://www.mapquestapi.com/geocoding/v1"},L.Util.setOptions(this,e),this.options.apiKey=decodeURIComponent(this.options.apiKey)}_formatName(...e){return e.filter(e=>!!e).join(", ")}geocode(e,i,r){e=geocodingParams(this.options,{key:this.options.apiKey,location:e,limit:5,outFormat:"json"});getJSON(this.options.serviceUrl+"/address",e,L.Util.bind(function(t){const o=[];if(t.results&&t.results[0].locations)for(let e=t.results[0].locations.length-1;0<=e;e--){var s=t.results[0].locations[e],n=L.latLng(s.latLng);o[e]={name:this._formatName(s.street,s.adminArea4,s.adminArea3,s.adminArea1),bbox:L.latLngBounds(n,n),center:n}}i.call(r,o)},this))}reverse(e,t,i,r){e=reverseParams(this.options,{key:this.options.apiKey,location:e.lat+","+e.lng,outputFormat:"json"});getJSON(this.options.serviceUrl+"/reverse",e,L.Util.bind(function(t){const o=[];if(t.results&&t.results[0].locations)for(let e=t.results[0].locations.length-1;0<=e;e--){var s=t.results[0].locations[e],n=L.latLng(s.latLng);o[e]={name:this._formatName(s.street,s.adminArea4,s.adminArea3,s.adminArea1),bbox:L.latLngBounds(n,n),center:n}}i.call(r,o)},this))}}function mapQuest(e){return new MapQuest(e)}class Neutrino{constructor(e){this.options={userId:void 0,apiKey:void 0,serviceUrl:"https://neutrinoapi.com/"},L.Util.setOptions(this,e)}geocode(e,n,i){e=geocodingParams(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,address:e.split(/\s+/).join(".")});getJSON(this.options.serviceUrl+"geocode-address",e,e=>{const t=[];var o,s;e.locations&&(e.geometry=e.locations[0],o=L.latLng(e.geometry.latitude,e.geometry.longitude),s=L.latLngBounds(o,o),t[0]={name:e.geometry.address,bbox:s,center:o}),n.call(i,t)})}suggest(e,t,o){return this.geocode(e,t,o)}reverse(n,e,i,r){var t=reverseParams(this.options,{apiKey:this.options.apiKey,userId:this.options.userId,latitude:n.lat,longitude:n.lng});getJSON(this.options.serviceUrl+"geocode-reverse",t,e=>{const t=[];var o,s;200==e.status.status&&e.found&&(o=L.latLng(n.lat,n.lng),s=L.latLngBounds(o,o),t[0]={name:e.address,bbox:s,center:o}),i.call(r,t)})}}function neutrino(e){return new Neutrino(e)}class Nominatim{constructor(e){this.options={serviceUrl:"https://nominatim.openstreetmap.org/",htmlTemplate:function(e){e=e.address;let t;const o=[];return(e.road||e.building)&&o.push("{building} {road} {house_number}"),(e.city||e.town||e.village||e.hamlet)&&(t=0<o.length?"leaflet-control-geocoder-address-detail":"",o.push('<span class="'+t+'">{postcode} {city} {town} {village} {hamlet}</span>')),(e.state||e.country)&&(t=0<o.length?"leaflet-control-geocoder-address-context":"",o.push('<span class="'+t+'">{state} {country}</span>')),template(o.join("<br/>"),e)}},L.Util.setOptions(this,e||{})}geocode(e,n,i){e=geocodingParams(this.options,{q:e,limit:5,format:"json",addressdetails:1});getJSON(this.options.serviceUrl+"search",e,t=>{const o=[];for(let e=t.length-1;0<=e;e--){const s=t[e].boundingbox;for(let e=0;e<4;e++)s[e]=+s[e];o[e]={icon:t[e].icon,name:t[e].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(t[e]):void 0,bbox:L.latLngBounds([s[0],s[2]],[s[1],s[3]]),center:L.latLng(t[e].lat,t[e].lon),properties:t[e]}}n.call(i,o)})}reverse(e,t,n,i){t=reverseParams(this.options,{lat:e.lat,lon:e.lng,zoom:Math.round(Math.log(t/256)/Math.log(2)),addressdetails:1,format:"json"});getJSON(this.options.serviceUrl+"reverse",t,e=>{const t=[];var o,s;e&&e.lat&&e.lon&&(o=L.latLng(e.lat,e.lon),s=L.latLngBounds(o,o),t.push({name:e.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(e):void 0,center:o,bbox:s,properties:e})),n.call(i,t)})}}function nominatim(e){return new Nominatim(e)}class OpenLocationCode{constructor(e){L.Util.setOptions(this,e)}geocode(e,t,o){try{var s=this.options.OpenLocationCode.decode(e),n={name:e,center:L.latLng(s.latitudeCenter,s.longitudeCenter),bbox:L.latLngBounds(L.latLng(s.latitudeLo,s.longitudeLo),L.latLng(s.latitudeHi,s.longitudeHi))};t.call(o,[n])}catch(e){console.warn(e),t.call(o,[])}}reverse(e,t,o,s){try{var n={name:this.options.OpenLocationCode.encode(e.lat,e.lng,this.options.codeLength),center:L.latLng(e.lat,e.lng),bbox:L.latLngBounds(L.latLng(e.lat,e.lng),L.latLng(e.lat,e.lng))};o.call(s,[n])}catch(e){console.warn(e),o.call(s,[])}}}function openLocationCode(e){return new OpenLocationCode(e)}class OpenCage{constructor(e){this.options={serviceUrl:"https://api.opencagedata.com/geocode/v1/json"},L.Util.setOptions(this,e)}geocode(e,t,r){e=geocodingParams(this.options,{key:this.options.apiKey,q:e});getJSON(this.options.serviceUrl,e,o=>{const s=[];if(o.results&&o.results.length)for(let t=0;t<o.results.length;t++){var n=o.results[t],i=L.latLng(n.geometry);let e;e=n.annotations&&n.annotations.bounds?L.latLngBounds(L.latLng(n.annotations.bounds.northeast),L.latLng(n.annotations.bounds.southwest)):L.latLngBounds(i,i),s.push({name:n.formatted,bbox:e,center:i})}t.call(r,s)})}suggest(e,t,o){return this.geocode(e,t,o)}reverse(e,t,r,a){e=reverseParams(this.options,{key:this.options.apiKey,q:[e.lat,e.lng].join(",")});getJSON(this.options.serviceUrl,e,o=>{const s=[];if(o.results&&o.results.length)for(let t=0;t<o.results.length;t++){var n=o.results[t],i=L.latLng(n.geometry);let e;e=n.annotations&&n.annotations.bounds?L.latLngBounds(L.latLng(n.annotations.bounds.northeast),L.latLng(n.annotations.bounds.southwest)):L.latLngBounds(i,i),s.push({name:n.formatted,bbox:e,center:i})}r.call(a,s)})}}function opencage(e){return new OpenCage(e)}class Pelias{constructor(e){this.options={serviceUrl:"https://api.geocode.earth/v1"},this._lastSuggest=0,L.Util.setOptions(this,e)}geocode(e,t,o){e=geocodingParams(this.options,{api_key:this.options.apiKey,text:e});getJSON(this.options.serviceUrl+"/search",e,e=>{t.call(o,this._parseResults(e,"bbox"))})}suggest(e,t,o){e=geocodingParams(this.options,{api_key:this.options.apiKey,text:e});getJSON(this.options.serviceUrl+"/autocomplete",e,e=>{e.geocoding.timestamp>this._lastSuggest&&(this._lastSuggest=e.geocoding.timestamp,t.call(o,this._parseResults(e,"bbox")))})}reverse(e,t,o,s){e=reverseParams(this.options,{api_key:this.options.apiKey,"point.lat":e.lat,"point.lon":e.lng});getJSON(this.options.serviceUrl+"/reverse",e,e=>{o.call(s,this._parseResults(e,"bounds"))})}_parseResults(e,i){const r=[];return L.geoJSON(e,{pointToLayer:function(e,t){return L.circleMarker(t)},onEachFeature:function(e,t){const o={};let s,n;t.getBounds?(s=t.getBounds(),n=s.getCenter()):s=t.feature.bbox?(n=t.getLatLng(),L.latLngBounds(L.GeoJSON.coordsToLatLng(t.feature.bbox.slice(0,2)),L.GeoJSON.coordsToLatLng(t.feature.bbox.slice(2,4)))):(n=t.getLatLng(),L.latLngBounds(n,n)),o.name=t.feature.properties.label,o.center=n,o[i]=s,o.properties=t.feature.properties,r.push(o)}}),r}}function pelias(e){return new Pelias(e)}const GeocodeEarth=Pelias,geocodeEarth=pelias,Mapzen=Pelias,mapzen=pelias;class Openrouteservice extends Pelias{constructor(e){super(L.Util.extend({serviceUrl:"https://api.openrouteservice.org/geocode"},e))}}function openrouteservice(e){return new Openrouteservice(e)}class Photon{constructor(e){this.options={serviceUrl:"https://photon.komoot.io/api/",reverseUrl:"https://photon.komoot.io/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},L.Util.setOptions(this,e)}geocode(e,t,o){e=geocodingParams(this.options,{q:e});getJSON(this.options.serviceUrl,e,L.Util.bind(function(e){t.call(o,this._decodeFeatures(e))},this))}suggest(e,t,o){return this.geocode(e,t,o)}reverse(e,t,o,s){e=reverseParams(this.options,{lat:e.lat,lon:e.lng});getJSON(this.options.reverseUrl,e,L.Util.bind(function(e){o.call(s,this._decodeFeatures(e))},this))}_decodeFeatures(t){const o=[];if(t&&t.features)for(let e=0;e<t.features.length;e++){var s=t.features[e],n=s.geometry.coordinates,i=L.latLng(n[1],n[0]),n=s.properties.extent,n=n?L.latLngBounds([n[1],n[0]],[n[3],n[2]]):L.latLngBounds(i,i);o.push({name:this._decodeFeatureName(s),html:this.options.htmlTemplate?this.options.htmlTemplate(s):void 0,center:i,bbox:n,properties:s.properties})}return o}_decodeFeatureName(t){return(this.options.nameProperties||[]).map(e=>t.properties[e]).filter(e=>!!e).join(", ")}}function photon(e){return new Photon(e)}class What3Words{constructor(e){this.options={serviceUrl:"https://api.what3words.com/v2/"},L.Util.setOptions(this,e)}geocode(e,n,i){getJSON(this.options.serviceUrl+"forward",geocodingParams(this.options,{key:this.options.apiKey,addr:e.split(/\s+/).join(".")}),e=>{const t=[];var o,s;e.geometry&&(o=L.latLng(e.geometry.lat,e.geometry.lng),s=L.latLngBounds(o,o),t[0]={name:e.words,bbox:s,center:o}),n.call(i,t)})}suggest(e,t,o){return this.geocode(e,t,o)}reverse(e,t,n,i){getJSON(this.options.serviceUrl+"reverse",reverseParams(this.options,{key:this.options.apiKey,coords:[e.lat,e.lng].join(",")}),e=>{const t=[];var o,s;200==e.status.status&&(o=L.latLng(e.geometry.lat,e.geometry.lng),s=L.latLngBounds(o,o),t[0]={name:e.words,bbox:s,center:o}),n.call(i,t)})}}function what3words(e){return new What3Words(e)}var geocoders={__proto__:null,geocodingParams:geocodingParams,reverseParams:reverseParams,ArcGis:ArcGis,arcgis:arcgis,Bing:Bing,bing:bing,Google:Google,google:google,HERE:HERE,HEREv2:HEREv2,here:here,parseLatLng:parseLatLng,LatLng:LatLng,latLng:latLng,Mapbox:Mapbox,mapbox:mapbox,MapQuest:MapQuest,mapQuest:mapQuest,Neutrino:Neutrino,neutrino:neutrino,Nominatim:Nominatim,nominatim:nominatim,OpenLocationCode:OpenLocationCode,openLocationCode:openLocationCode,OpenCage:OpenCage,opencage:opencage,Pelias:Pelias,pelias:pelias,GeocodeEarth:GeocodeEarth,geocodeEarth:geocodeEarth,Mapzen:Mapzen,mapzen:mapzen,Openrouteservice:Openrouteservice,openrouteservice:openrouteservice,Photon:Photon,photon:photon,What3Words:What3Words,what3words:what3words};class EventedControl{constructor(){}}L.Util.extend(EventedControl.prototype,L.Control.prototype),L.Util.extend(EventedControl.prototype,L.Evented.prototype);class GeocoderControl extends EventedControl{constructor(e){super(e),this.options={showUniqueResult:!0,showResultIcons:!1,collapsed:!0,expand:"touch",position:"topright",placeholder:"Search...",errorMessage:"Nothing found.",iconLabel:"Initiate a new search",query:"",queryMinLength:1,suggestMinLength:3,suggestTimeout:250,defaultMarkGeocode:!0},this._requestCount=0,L.Util.setOptions(this,e),this.options.geocoder||(this.options.geocoder=new Nominatim)}addThrobberClass(){L.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber")}removeThrobberClass(){L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber")}onAdd(e){var t="leaflet-control-geocoder",o=L.DomUtil.create("div",t+" leaflet-bar");const s=L.DomUtil.create("button",t+"-icon",o);var n=this._form=L.DomUtil.create("div",t+"-form",o);this._map=e,this._container=o,s.innerHTML="&nbsp;",s.type="button",s.setAttribute("aria-label",this.options.iconLabel);const i=this._input=L.DomUtil.create("input","",n);return i.type="text",i.value=this.options.query,i.placeholder=this.options.placeholder,L.DomEvent.disableClickPropagation(i),this._errorElement=L.DomUtil.create("div",t+"-form-no-error",o),this._errorElement.innerHTML=this.options.errorMessage,this._alts=L.DomUtil.create("ul",t+"-alternatives leaflet-control-geocoder-alternatives-minimized",o),L.DomEvent.disableClickPropagation(this._alts),L.DomEvent.addListener(i,"keydown",this._keydown,this),this.options.geocoder.suggest&&L.DomEvent.addListener(i,"input",this._change,this),L.DomEvent.addListener(i,"blur",()=>{this.options.collapsed&&!this._preventBlurCollapse&&this._collapse(),this._preventBlurCollapse=!1}),this.options.collapsed?"click"===this.options.expand?L.DomEvent.addListener(o,"click",e=>{0===e.button&&2!==e.detail&&this._toggle()}):"touch"===this.options.expand?L.DomEvent.addListener(o,L.Browser.touch?"touchstart mousedown":"mousedown",e=>{this._toggle(),e.preventDefault(),e.stopPropagation()},this):(L.DomEvent.addListener(o,"mouseover",this._expand,this),L.DomEvent.addListener(o,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(this._expand(),L.Browser.touch?L.DomEvent.addListener(o,"touchstart",()=>this._geocode()):L.DomEvent.addListener(o,"click",()=>this._geocode())),this.options.defaultMarkGeocode&&this.on("markgeocode",this.markGeocode,this),this.on("startgeocode",this.addThrobberClass,this),this.on("finishgeocode",this.removeThrobberClass,this),this.on("startsuggest",this.addThrobberClass,this),this.on("finishsuggest",this.removeThrobberClass,this),L.DomEvent.disableClickPropagation(o),o}setQuery(e){return this._input.value=e,this}_geocodeResult(t,e){if(!e&&this.options.showUniqueResult&&1===t.length)this._geocodeResultSelected(t[0]);else if(0<t.length){this._alts.innerHTML="",this._results=t,L.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),L.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-open");for(let e=0;e<t.length;e++)this._alts.appendChild(this._createAlt(t[e],e))}else L.DomUtil.addClass(this._container,"leaflet-control-geocoder-options-error"),L.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")}markGeocode(e){e=e.geocode;return this._map.fitBounds(e.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new L.Marker(e.center).bindPopup(e.html||e.name).addTo(this._map).openPopup(),this}_geocode(o){const s=this._input.value;if(o||!(s.length<this.options.queryMinLength)){const n=++this._requestCount;var e=e=>{var t;n===this._requestCount&&(t={input:s,results:e},this.fire(o?"finishsuggest":"finishgeocode",t),this._geocodeResult(e,o))};this._lastGeocode=s,o||this._clearResults();var t={input:s};this.fire(o?"startsuggest":"startgeocode",t),o?this.options.geocoder.suggest(s,e):this.options.geocoder.geocode(s,e)}}_geocodeResultSelected(e){this.fire("markgeocode",{geocode:e})}_toggle(){L.DomUtil.hasClass(this._container,"leaflet-control-geocoder-expanded")?this._collapse():this._expand()}_expand(){L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select(),this.fire("expand")}_collapse(){L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-expanded"),L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error"),this._input.blur(),this.fire("collapse")}_clearResults(){L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error"),L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-open"),L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-options-error")}_createAlt(t,e){const o=L.DomUtil.create("li",""),s=L.DomUtil.create("a","",o),n=this.options.showResultIcons&&t.icon?L.DomUtil.create("img","",s):null,i=t.html?void 0:document.createTextNode(t.name);return n&&(n.src=t.icon),o.setAttribute("data-result-index",String(e)),t.html?s.innerHTML=s.innerHTML+t.html:i&&s.appendChild(i),L.DomEvent.addListener(o,"mousedown touchstart",e=>{this._preventBlurCollapse=!0,L.DomEvent.stop(e),this._geocodeResultSelected(t),L.DomEvent.on(o,"click touchend",()=>{this.options.collapsed?this._collapse():this._clearResults()})},this),o}_keydown(e){var t,o=e=>{this._selection&&(L.DomUtil.removeClass(this._selection,"leaflet-control-geocoder-selected"),this._selection=this._selection[0<e?"nextSibling":"previousSibling"]),this._selection||(this._selection=this._alts[0<e?"firstChild":"lastChild"]),this._selection&&L.DomUtil.addClass(this._selection,"leaflet-control-geocoder-selected")};switch(e.keyCode){case 27:this.options.collapsed?this._collapse():this._clearResults();break;case 38:o(-1);break;case 40:o(1);break;case 13:this._selection?(t=parseInt(this._selection.getAttribute("data-result-index"),10),this._geocodeResultSelected(this._results[t]),this._clearResults()):this._geocode();break;default:return}L.DomEvent.preventDefault(e)}_change(){var e=this._input.value;e!==this._lastGeocode&&(clearTimeout(this._suggestTimeout),e.length>=this.options.suggestMinLength?this._suggestTimeout=setTimeout(()=>this._geocode(!0),this.options.suggestTimeout):this._clearResults())}}function geocoder(e){return new GeocoderControl(e)}L.Util.extend(GeocoderControl,geocoders),L.Util.extend(L.Control,{Geocoder:GeocoderControl,geocoder:geocoder});export default GeocoderControl;